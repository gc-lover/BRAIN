---
**api-readiness:** ready  
**api-readiness-check-date:** 2025-11-07 16:14
**api-readiness-notes:** Комплект решений по D&D-проверкам: типы кубиков, интеграция в квесты, сюжет и игровые механики.
---

# Боевая система в стиле D&D - Кубики и проверки

**Статус:** approved (архив справочник)  
**Приоритет:** high  
**Дата создания:** 2025-11-05  
**Дата завершения:** 2025-11-06  
**Дата архивации:** 2025-11-07 01:59  
**Дата обновления:** 2025-11-07 16:14  
**Связанные документы:** 
- `02-gameplay/combat/combat-overview.md`
- `04-narrative/quests/main-quests-outline.md`
- Система квестов готова

---

## Цель

Проработать боевую систему в стиле D&D с использованием кубиков и проверок навыков, интегрировать её в:
1. Квесты - какие проверки будут и где
2. Сюжет игры - глубокое использование кубиков в повествовании
3. Различные игровые механики - интеграция проверок во все системы

---

## Контекст

### Текущая боевая система

В текущей боевой системе (см. `combat-overview.md`):
- MMORPG основа + аркадная стрельба
- Система способностей (VALORANT стиль)
- Система навыков и классов
- Нет упоминаний о D&D механике кубиков/проверок

### Текущая система квестов

В текущей системе квестов (см. `main-quests-outline.md`):
- Базовые квесты с ветвлением
- Нет упоминаний о проверках навыков
- Нет механики кубиков

---

## Ключевые решения

### 1. Боевая система в стиле D&D — итог

- **Кубики:** базовый d20 (skill/attack checks), d100 для «Wild Surge» событий и редких имплантов. Advantage/disadvantage реализованы броском двух d20 с выбором большего/меньшего.
- **Атрибуты:** используется шесть параметров (`Body`, `Reflex`, `Intellect`, `Tech`, `Charisma`, `Will`). Формула: `d20 + модификатор атрибута + proficiency + контекстные бонусы - штрафы`.
- **Модификаторы:** импланты, перки, состояние окружения. Ограничение: суммарный бонус не превышает +8, штраф не ниже -6.
- **Интеграция с шутером:** микро-проверки запускаются в момент спец-действий (взлом дверей, перезарядка под давлением). Бой продолжается в real-time; результат проверки влияет на баффы/дебаффы (`stability`, `focus`).
- **Типы проверок:** атака (оружие/способности), защита (укрытие, уклонение), навыки (взлом, медицина, инженерия), социальные (интимидейт, парлей), реакция (перехват).
- **Инициатива:** гибридная — базовый приоритет на основе `Reflex`, далее ходовые «окна» длительностью 3 сек. Партийные баффы возможны.
- **Криты:** `натуральный 20` → критический успех (x2 эффект или спец-анимация), `натуральный 1` → критический провал (откат, перегрев импланта). В PvP включены безопасные пороги (макс +50% / -50%).

### 2. Интеграция в квесты и UI

- **Диалоги:** категории `Persuasion`, `Deception`, `Intimidation`, `Empathy`, `Analysis`. Каждая имеет DC-грейды (Easy 10, Standard 14, Hard 18, Legendary 22).
- **Исследование:** `Perception`, `Investigation`, `Netrunning`, `Forensics`. Используются в миссиях heist и ветках расследований.
- **Действия:** `Engineering`, `Medicine`, `Crafting`, `Demolition`. Проверки могут быть групповые (используем средний результат + наименьший бросок для провалов).
- **Социальные взаимодействия:** фракционные проверки `Reputation Check` (вес зависит от репутации), романтические `Affinity Gate` (см. romance system).
- **Ветвление:** положительный результат добавляет флаги в `quest_branches`; провал может открыть ветку «Complication». Все флаги синхронизируются с `quest_progress` и `player_flags`.
- **UI:** компонент `shared/ui/SkillCheckPrompt` (варианты `dialogue`, `combat`, `world`). Показывает куб, модификаторы, прогноз успеха. Повторная попытка доступна только при наличии ресурса `Focus Point` или после таймера.
- **Повторные попытки:** ограничены 1 разом для non-critical задач, требуют затрат `Focus` или `kit` (например, механик-комплект для ремонта).
- **Сложность:** DC рассчитывается динамически: `base + world tier + modifiers`. Формулы приведены в `combat-dnd-core.md`.

### 3. Интеграция в сюжет и отношения

- **Ключевые моменты:** сюжетные арки `Throne of Sand`, `Blackwall Expedition`, `Quantum Reef`. Проверки определяют, какие сцены открываются и какие NPC выживают.
- **Развитие персонажа:** выборы повышают `personal_arc_progress`, разблокируя перки или импланты (см. progression docs).
- **NPC отношения:** каждая романтическая ветка имеет `Affinity Threshold` + «Trust Rolls». Успех открывает эксклюзивные сцены, провал — ветку конфликта.
- **Финалы:** глобальные проверки (кооперативные) влияют на экстремальные концовки (например, активировать протокол Free Peoples). Триггеры хранятся в `world_state`.
- **Репутация фракций:** флаги последствий `reputation_changes` (±5..±20). Провал критичной проверки может снизить доступ к штабам.

### 4. Интеграция в механики

- **Хакерство:** проверки `Netrunning` вызывают мини-игры с бросками; бонусы от кибердеков, штрафы от сетевых глитчей. Успех → мгновенные хаки, провал → тревога.
- **Крафт:** `Engineering` + `Crafting`. d20 определяет качество предмета, d100 — шанс особого свойства. Усилено системой «Blueprint Mastery».
- **Торговля:** `Negotiation` проверки влияют на скидки/комиссии. В PvP рынках применяется contested roll (игрок против NPC).
- **Социальные механики:** клановые собрания используют групповые проверки (`Leadership`, `Influence`). Результат модифицирует клановые баффы.
- **Экономика:** `Risk Roll` (d20) для страховок и контрабанды. Успех снижает пошлину, провал добавляет штрафы `economy-service`.
- **Прокачка:** опыт за сложные проверки, перки «Dice Mastery» уменьшают DC или добавляют reroll.

---

## План работы (выполнен)

> План реализации сохранён как историческая справка. Все этапы закрыты (см. раздел «Прогресс работы»).

### Этап 1: Проработка базовой механики D&D

1. Определить тип кубиков и систему проверок
2. Определить характеристики и модификаторы
3. Проработать базовые типы проверок
4. Интегрировать с существующей системой классов и навыков

### Этап 2: Интеграция в квесты

1. Определить типы проверок для квестов
2. Проработать проверки в диалогах
3. Проработать проверки в действиях
4. Проработать влияние на ветвление
5. Проработать UI для проверок

### Этап 3: Интеграция в сюжет

1. Определить ключевые моменты сюжета с проверками
2. Проработать влияние на развитие персонажей
3. Проработать влияние на отношения
4. Проработать влияние на финалы

### Этап 4: Интеграция в игровые механики

1. Хакерство
2. Крафт
3. Торговля
4. Социальные механики
5. Экономика
6. Прокачка

---

## Связанные системы

- **Классы и навыки:** `02-gameplay/progression/classes-overview.md`
- **Боевая система:** `02-gameplay/combat/combat-overview.md`
- **Квесты:** `04-narrative/quests/main-quests-outline.md`
- **Социальные механики:** `02-gameplay/social/`
- **Экономика:** `02-gameplay/economy/`

---

## Прогресс работы

### ✅ Завершено (2025-11-05):

1. **Базовое ядро D&D системы:**
   - ✅ Создан документ `combat-dnd-core.md` с базовой механикой
   - ✅ Определены типы кубиков (d20, d100)
   - ✅ Формула проверок и DC
   - ✅ Критические успехи/провалы
   - ✅ Система преимуществ/помех

2. **Расширение ядра системы:**
   - ✅ Добавлены классовые модификаторы для всех 13 классов
   - ✅ Создана таблица соответствий: Атрибут → Навык → Тип проверки
   - ✅ Детализированы групповые проверки (MMORPG контекст)
   - ✅ Система повторных попыток и ограничений

3. **Интеграция в квесты:**
   - ✅ Создан документ `quest-dnd-checks.md` с категориями проверок
   - ✅ Детальные узлы для квеста 1.1 «Первые шаги»
   - ✅ Детальные узлы для квеста 1.2 «Выбор пути»
   - ✅ Детальные узлы для квеста 4.2 «Взлом заслона» (heist)
   - ✅ Создан шаблон для побочных квестов

4. **Интеграция с боем:**
   - ✅ Создан документ `combat-dnd-integration-shooter.md`
   - ✅ Микро-проверки в реальном бою
   - ✅ Влияние имплантов и способностей

5. **Интеграция в механики:**
   - ✅ Создан документ `combat-dnd-mechanics-integration.md`
   - ✅ Хакерство, крафт, торговля, социальные механики

6. **Связывание документов:**
   - ✅ Обновлен `combat-overview.md` с ссылками на D&D систему
   - ✅ Обновлен `quest-system.md` с D&D/MMORPG правилами
   - ✅ Обновлен `main-quests-outline.md` с ссылками на проверки
   - ✅ Создан индекс `quests/main/README.md`

### ✅ Завершено (2025-11-06):

- ✅ Детализация узлов для основных квестов (создан главный сюжет 2090-2093)
- ✅ Балансировка DC и модификаторов (определены диапазоны в combat-dnd-core.md)
- ✅ Интеграция с UI системой (определена в quest-system.md и ui-main-game.md)
- ✅ Все 3 D&D документа обновлены до статуса ready/approved

## История изменений

- 2025-11-05 - Создание задачи на проработку D&D боевой системы
- 2025-11-05 - Завершена базовая проработка системы проверок и интеграция в квесты
- 2025-11-07 16:14 - Документ обновлён, зафиксированы итоговые решения и метаданные готовности



