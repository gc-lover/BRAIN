# Начало игры после создания персонажа

**Статус:** review - детализация завершена  
**Версия:** 1.0.0  
**Дата создания:** 2025-11-04  
**Последнее обновление:** 2025-11-04  
**Приоритет:** высокий

**api-readiness:** ready  
**api-readiness-check-date:** 2025-11-04 18:05  
**api-readiness-notes:** Документ готов к созданию API задач. Содержит детальное описание начального экрана игры, боевой системы D&D формата с кубиками, механики действий и взаимодействий. Все необходимые детали для создания API спецификации присутствуют (v1.0.0).

---

## Общее описание

Описание начального экрана игры после создания персонажа и нажатия "ИГРАТЬ" для текстовой веб-версии NECPGAME. Включает основной интерфейс игры и боевую систему в формате D&D (Dungeons & Dragons) с системой кубиков и вероятностей.

**Важно:** Это текстовый интерфейс с минимальной графикой (браузерный онлайн формат), боевая система работает на основе кубиков и вероятностей, как в D&D.

---

## 1. Первый экран после входа в игру

### 1.1. Экран приветствия и туториал

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ДОБРО ПОЖАЛОВАТЬ В NECPGAME          │
│                                         │
│  Ночь в Night City только начинается... │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ВАШ ПЕРСОНАЖ                     │   │
│  │ Имя: [Имя персонажа]             │   │
│  │ Класс: [Класс]                   │   │
│  │ Уровень: 1                       │   │
│  │ Локация: Night City - Downtown   │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Начать игру]  [Пропустить туториал]   │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Приветственное сообщение
- Краткая информация о персонаже
- Кнопка "Начать игру" - переход к основному интерфейсу
- Кнопка "Пропустить туториал" - переход к основному интерфейсу без подсказок

---

### 1.2. Основной интерфейс игры (Хаб персонажа)

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     NECPGAME - Night City               │
│     [Время: 2077-03-15 14:30]          │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ПЕРСОНАЖ                         │   │
│  │ Имя: Джон Доу                   │   │
│  │ Класс: Соло | Уровень: 1        │   │
│  │ Здоровье: ████████░░ 80/100     │   │
│  │ Энергия: ███████░░░ 70/100      │   │
│  │ Человечность: ██████░░░░ 60/100 │   │
│  │                                  │   │
│  │ Характеристики:                  │   │
│  │ Сила: 5 | Ловкость: 6           │   │
│  │ Интеллект: 4 | Техника: 5       │   │
│  │ Холоднокровие: 5                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ЛОКАЦИЯ                          │   │
│  │ Night City - Downtown            │   │
│  │ Район: Корпоративный центр       │   │
│  │ Опасность: Низкая                │   │
│  │                                  │   │
│  │ Вы стоите в центре корпоративного│   │
│  │ района Night City. Вокруг вас    │   │
│  │ возвышаются небоскребы корпораций│   │
│  │ Arasaka и Militech. Неоновые     │   │
│  │ вывески мигают на стенах зданий. │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Действия] [Инвентарь] [Характеристики]│
│  [Квесты] [Карта] [Социальное]         │
│  [Торговля] [Настройки] [Выход]         │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Отображение статуса персонажа (здоровье, энергия, человечность)
- Отображение характеристик персонажа
- Отображение текущей локации с текстовым описанием
- Быстрый доступ к основным функциям
- Индикатор игрового времени

---

### 1.3. Меню действий в локации

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ДОСТУПНЫЕ ДЕЙСТВИЯ                  │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Осмотреть окружение]            │   │
│  │ [Поговорить с NPC]               │   │
│  │ [Переместиться]                  │   │
│  │ [Отдохнуть]                      │   │
│  │ [Использовать предмет]           │   │
│  │ [Хакнуть систему]                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ NPC В ЛОКАЦИИ:                   │   │
│  │ • Джейк Арчер (Торговец)         │   │
│  │ • Сара Миллер (Квестодатель)     │   │
│  │ • Виктор Вектор (Риппердок)      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ДОСТУПНЫЕ ЛОКАЦИИ:               │   │
│  │ • Watson (Индустриальный район)  │   │
│  │ • Westbrook (Богатый район)     │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Назад]                                │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Список доступных действий в текущей локации
- Список NPC в локации (с возможностью взаимодействия)
- Список доступных локаций для перемещения
- Возврат в главное меню

---

## 2. Боевая система D&D формата

### 2.1. Концепция боевой системы

**Основные принципы:**
- Боевая система работает на основе кубиков (dice rolls), как в D&D
- Все действия в бою имеют вероятность успеха/неудачи
- Характеристики персонажа влияют на броски кубиков
- Оружие и снаряжение влияют на модификаторы бросков
- Каждое действие требует броска кубика (d20 или другой)

**Типы кубиков:**
- **d20** (1-20) - основной кубик для проверок действий
- **d12** (1-12) - для урона некоторых типов оружия
- **d10** (1-10) - для урона некоторых типов оружия
- **d8** (1-8) - для урона некоторых типов оружия
- **d6** (1-6) - для урона некоторых типов оружия
- **d4** (1-4) - для урона некоторых типов оружия

---

### 2.2. Механика бросков кубиков

**Базовый бросок:**
- Игрок выбирает действие (атака, защита, использование навыка)
- Система генерирует случайное число (бросок кубика)
- К броску добавляются модификаторы от характеристик
- Результат сравнивается с целевым числом (DC - Difficulty Class)

**Формула броска:**
```
Результат = Бросок кубика (d20) + Модификатор характеристики + Модификатор оружия/снаряжения + Бонусы
```

**Примеры модификаторов:**
- **Сила (STR):** Модификатор = (STR - 10) / 2 (округление вниз)
  - STR 5 = модификатор -2
  - STR 10 = модификатор 0
  - STR 15 = модификатор +2
  - STR 20 = модификатор +5

- **Ловкость (REF):** Модификатор = (REF - 10) / 2
  - Используется для атак оружием, уклонений, инициативы

- **Интеллект (INT):** Модификатор = (INT - 10) / 2
  - Используется для хакерства, использования технологий

- **Техника (TECH):** Модификатор = (TECH - 10) / 2
  - Используется для ремонта, использования сложных устройств

- **Холоднокровие (COOL):** Модификатор = (COOL - 10) / 2
  - Используется для критических попаданий, стелс-атак

---

### 2.3. Боевые действия

#### 2.3.1. Атака оружием

**Механика:**
1. Игрок выбирает оружие и цель
2. Бросок d20 для попадания
3. К броску добавляются модификаторы:
   - Модификатор Ловкости (REF) - для стрелкового оружия
   - Модификатор Силы (STR) - для ближнего оружия
   - Бонус оружия (зависит от качества оружия)
   - Бонусы от имплантов/навыков
4. Результат сравнивается с AC (Armor Class) врага
5. Если результат >= AC врага - попадание
6. Если попадание - бросок кубика урона оружия

**Пример:**
```
Игрок атакует пистолетом (урон d6+2)
Характеристики: REF 6 → модификатор -2
Бросок на попадание: d20 = 12
Результат: 12 + (-2) + 0 (базовое оружие) = 10
AC врага: 12
Результат: ПРОМАХ (10 < 12)
```

**Пример попадания:**
```
Игрок атакует пистолетом (урон d6+2)
Характеристики: REF 6 → модификатор -2
Бросок на попадание: d20 = 15
Результат: 15 + (-2) + 0 = 13
AC врага: 12
Результат: ПОПАДАНИЕ (13 >= 12)

Бросок урона: d6 = 4
Итоговый урон: 4 + 2 = 6 урона
```

---

#### 2.3.2. Критическое попадание

**Механика:**
- Если бросок на попадание = 20 (натуральная 20) - критическое попадание
- Урон удваивается
- Игнорирует часть брони врага

**Пример:**
```
Игрок атакует пистолетом
Бросок на попадание: d20 = 20 (КРИТИЧЕСКОЕ!)
Результат: КРИТИЧЕСКОЕ ПОПАДАНИЕ

Бросок урона: d6 = 5
Базовый урон: 5 + 2 = 7
Критический урон: 7 × 2 = 14 урона
```

---

#### 2.3.3. Критический промах

**Механика:**
- Если бросок на попадание = 1 (натуральная 1) - критический промах
- Атака автоматически промахивается
- Возможны дополнительные негативные эффекты (оружие заклинило, потеря баланса)

---

#### 2.3.4. Защита / Уклонение

**Механика:**
1. Враг атакует игрока
2. Игрок может попытаться уклониться (если есть действие)
3. Бросок d20 для уклонения
4. К броску добавляются модификаторы:
   - Модификатор Ловкости (REF)
   - Бонусы от брони/имплантов
5. Результат сравнивается с результатом атаки врага
6. Если результат уклонения >= результат атаки - уклонение успешно

**Пример:**
```
Враг атакует игрока
Результат атаки врага: 15
Игрок пытается уклониться
Характеристики: REF 6 → модификатор -2
Бросок на уклонение: d20 = 14
Результат: 14 + (-2) + 1 (броня) = 13
Результат: ПРОМАХ ВРАГА (13 < 15, но враг все равно попадает)
```

---

#### 2.3.5. Использование навыков

**Механика:**
- Хакерство, использование технологий, ремонт - требуют проверки навыков
- Бросок d20 + модификатор соответствующей характеристики
- Результат сравнивается с DC (Difficulty Class) задачи

**Примеры:**
- **Хакерство:** d20 + модификатор INT + бонусы от кибердеки
  - DC для простого взлома: 10
  - DC для сложного взлома: 15
  - DC для очень сложного взлома: 20

- **Ремонт:** d20 + модификатор TECH + бонусы от инструментов
  - DC для простого ремонта: 10
  - DC для сложного ремонта: 15

---

### 2.4. Интерфейс боя

#### 2.4.1. Начало боя

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     БОЙ НАЧАЛСЯ!                         │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ВАШ ПЕРСОНАЖ                     │   │
│  │ Здоровье: ████████░░ 80/100     │   │
│  │ Энергия: ███████░░░ 70/100      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ВРАГ: Бандит                    │   │
│  │ Здоровье: ██████████ 100/100   │   │
│  │ AC: 12                          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Атаковать] [Защищаться] [Использовать]│
│  [Убежать] [Инвентарь]                 │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.2. Выбор действия в бою

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ВАШ ХОД                             │
│                                         │
│  Выберите действие:                     │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Атака оружием]                 │   │
│  │ • Пистолет (d6+2 урон)         │   │
│  │ • Нож (d4+1 урон)               │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Защита]                        │   │
│  │ • Принять защитную позицию      │   │
│  │ • Уклониться                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Использовать предмет]          │   │
│  │ • Медипак (восстановление +50)  │   │
│  │ • Стимулятор (энергия +30)      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Использовать навык]            │   │
│  │ • Хакерство                     │   │
│  │ • Ремонт                        │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Убежать] [Отмена]                     │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.3. Результат действия в бою

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     РЕЗУЛЬТАТ ДЕЙСТВИЯ                   │
│                                         │
│  Вы атакуете пистолетом!                │
│                                         │
│  Бросок на попадание: d20 = 15          │
│  Модификатор Ловкости (REF 6): -2       │
│  Итоговый результат: 13                 │
│                                         │
│  AC врага: 12                           │
│                                         │
│  ✅ ПОПАДАНИЕ!                          │
│                                         │
│  Бросок урона: d6 = 4                   │
│  Базовый урон оружия: +2                │
│  Итоговый урон: 6                       │
│                                         │
│  Враг получает 6 урона!                 │
│  Здоровье врага: 94/100                 │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Пример промаха:**

```
┌─────────────────────────────────────────┐
│     РЕЗУЛЬТАТ ДЕЙСТВИЯ                   │
│                                         │
│  Вы атакуете пистолетом!                │
│                                         │
│  Бросок на попадание: d20 = 8           │
│  Модификатор Ловкости (REF 6): -2       │
│  Итоговый результат: 6                  │
│                                         │
│  AC врага: 12                           │
│                                         │
│  ❌ ПРОМАХ!                             │
│                                         │
│  Выстрел не попал в цель.               │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Пример критического попадания:**

```
┌─────────────────────────────────────────┐
│     РЕЗУЛЬТАТ ДЕЙСТВИЯ                   │
│                                         │
│  Вы атакуете пистолетом!                │
│                                         │
│  Бросок на попадание: d20 = 20 ⚡       │
│  Модификатор Ловкости (REF 6): -2       │
│                                         │
│  ⚡ КРИТИЧЕСКОЕ ПОПАДАНИЕ! ⚡           │
│                                         │
│  Бросок урона: d6 = 5                   │
│  Базовый урон оружия: +2                │
│  Базовый урон: 7                        │
│  Критический множитель: ×2              │
│  Итоговый урон: 14                      │
│                                         │
│  Враг получает 14 урона!                │
│  Здоровье врага: 86/100                 │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.4. Ход врага

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ХОД ВРАГА                           │
│                                         │
│  Бандит атакует вас!                    │
│                                         │
│  Бросок на попадание: d20 = 14          │
│  Результат атаки врага: 14              │
│                                         │
│  Ваш AC: 12                             │
│                                         │
│  ⚠️ ВРАГ ПОПАДАЕТ!                     │
│                                         │
│  Бросок урона: d6 = 3                   │
│  Урон врага: 3                          │
│                                         │
│  Вы получаете 3 урона!                  │
│  Здоровье: 77/100                       │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.5. Конец боя

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     БОЙ ЗАВЕРШЕН!                       │
│                                         │
│  ✅ ВРАГ ПОВЕРЖЕН!                     │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ НАГРАДЫ:                         │   │
│  │ • Опыт: +100 XP                 │   │
│  │ • Деньги: +50 eddies             │   │
│  │ • Лут:                           │   │
│  │   - Компоненты (x3)              │   │
│  │   - Медипак (x1)                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Забрать лут] [Продолжить]            │
│                                         │
└─────────────────────────────────────────┘
```

---

## 3. Технические требования

### 3.1. API Endpoints для боя

**POST /api/v1/combat/start**
- Начать бой с врагом
- Request: `{ "characterId": "uuid", "enemyId": "uuid", "locationId": "uuid" }`
- Response: `{ "combatId": "uuid", "turn": "player", "status": "active" }`

**POST /api/v1/combat/{combatId}/action**
- Выполнить действие в бою
- Request: `{ "action": "attack", "weaponId": "uuid", "target": "enemy" }`
- Response: `{ "success": true, "diceRoll": 15, "result": "hit", "damage": 6, "log": "..." }`

**GET /api/v1/combat/{combatId}/status**
- Получить статус боя
- Response: `{ "status": "active", "turn": "player", "playerHealth": 80, "enemyHealth": 94 }`

**POST /api/v1/combat/{combatId}/end**
- Завершить бой (если враг повержен или игрок убежал)
- Response: `{ "victory": true, "rewards": { "experience": 100, "money": 50, "loot": [...] } }`

---

### 3.2. Механика генерации кубиков

**На сервере:**
- Генерация случайных чисел для бросков кубиков
- Использование криптографически безопасного генератора случайных чисел
- Сохранение результатов бросков в логе боя

**Формулы:**
- **d20 бросок:** `random(1, 20)`
- **d12 бросок:** `random(1, 12)`
- **d10 бросок:** `random(1, 10)`
- **d8 бросок:** `random(1, 8)`
- **d6 бросок:** `random(1, 6)`
- **d4 бросок:** `random(1, 4)`

---

### 3.3. Модификаторы характеристик

**Таблица модификаторов:**
- Характеристика 1-2: модификатор -5
- Характеристика 3-4: модификатор -4
- Характеристика 5-6: модификатор -2
- Характеристика 7-8: модификатор -1
- Характеристика 9-10: модификатор 0
- Характеристика 11-12: модификатор +1
- Характеристика 13-14: модификатор +2
- Характеристика 15-16: модификатор +3
- Характеристика 17-18: модификатор +4
- Характеристика 19-20: модификатор +5

---

## 4. Примеры игрового процесса

### 4.1. Пример боя

**Шаг 1: Игрок атакует**
```
Действие: Атака пистолетом
Бросок: d20 = 15
Модификатор REF (6): -2
Результат: 13
AC врага: 12
Результат: ПОПАДАНИЕ

Урон: d6 = 4
Базовый урон: +2
Итоговый урон: 6
Здоровье врага: 94/100
```

**Шаг 2: Враг атакует**
```
Действие врага: Атака
Бросок: d20 = 14
Результат: 14
AC игрока: 12
Результат: ПОПАДАНИЕ

Урон: d6 = 3
Здоровье игрока: 77/100
```

**Шаг 3: Игрок использует медипак**
```
Действие: Использовать медипак
Восстановление: +50
Здоровье игрока: 127/100 → 100/100 (максимум)
```

**Шаг 4: Игрок атакует (критическое попадание)**
```
Действие: Атака пистолетом
Бросок: d20 = 20 (КРИТИЧЕСКОЕ!)
Результат: КРИТИЧЕСКОЕ ПОПАДАНИЕ

Урон: d6 = 5
Базовый урон: +2 = 7
Критический урон: 7 × 2 = 14
Здоровье врага: 80/100
```

**Шаг 5: Враг повержен**
```
Враг получает финальный урон
Здоровье врага: 0/100
Результат: ВРАГ ПОВЕРЖЕН

Награды:
- Опыт: +100 XP
- Деньги: +50 eddies
- Лут: Компоненты (x3), Медипак (x1)
```

---

## 5. Связанные документы

- [Основной интерфейс](./ui-main-game.md) - детальное описание основного интерфейса
- [API Endpoints](./api-requirements/mvp-endpoints.md) - детальные API endpoints
- [Модели данных](./api-requirements/mvp-data-models.md) - модель Combat

---

## 6. TODO

**TODO:** Добавить больше вариантов действий в бою (специальные атаки, способности) - требуется для разнообразия.

**TODO:** Добавить систему преимуществ/недостатков (advantage/disadvantage) как в D&D - требуется для глубины механики.

**TODO:** Добавить систему инициативы (кто ходит первым) - требуется для реалистичности боя.

**TODO:** Добавить систему состояний (отравление, оглушение, и т.д.) - требуется для разнообразия.

---

## История изменений

- v1.0.0 (2025-11-04) - Создание документа с описанием начала игры и боевой системы D&D формата

