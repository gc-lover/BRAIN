# Начало игры после создания персонажа

**Статус:** review - детализация завершена  
**Версия:** 1.1.0  
**Дата создания:** 2025-11-04  
**Последнее обновление:** 2025-11-05  
**Приоритет:** высокий

**api-readiness:** ready  
**api-readiness-check-date:** 2025-11-04 18:05  
**api-readiness-notes:** Документ готов к созданию API задач. Содержит детальное описание начального экрана игры, боевой системы D&D формата с кубиками, механики действий и взаимодействий. Все необходимые детали для создания API спецификации присутствуют (v1.0.0).

---
**API Tasks Status:**
- Status: created
- Tasks:
  - API-TASK-113: api/v1/ui/game-start.yaml (2025-11-07)
- Last Updated: 2025-11-07 06:05
---

---

## Общее описание

Описание начального экрана игры после создания персонажа и нажатия "ИГРАТЬ" для текстовой веб-версии NECPGAME. Включает основной интерфейс игры и боевую систему в формате D&D (Dungeons & Dragons) с системой кубиков и вероятностей.

**Важно:** Это текстовый интерфейс с минимальной графикой (браузерный онлайн формат), боевая система работает на основе кубиков и вероятностей, как в D&D.

---

## 1. Первый экран после входа в игру

### 1.1. Экран приветствия и туториал

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ДОБРО ПОЖАЛОВАТЬ В NECPGAME          │
│                                         │
│  Ночь в Night City только начинается... │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ВАШ ПЕРСОНАЖ                     │   │
│  │ Имя: [Имя персонажа]             │   │
│  │ Класс: [Класс]                   │   │
│  │ Уровень: 1                       │   │
│  │ Локация: Night City - Downtown   │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Начать игру]  [Пропустить туториал]   │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Приветственное сообщение
- Краткая информация о персонаже
- Кнопка "Начать игру" - переход к основному интерфейсу
- Кнопка "Пропустить туториал" - переход к основному интерфейсу без подсказок

---

### 1.2. Основной интерфейс игры (Хаб персонажа)

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     NECPGAME - Night City               │
│     [Время: 2077-03-15 14:30]          │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ПЕРСОНАЖ                         │   │
│  │ Имя: Джон Доу                   │   │
│  │ Класс: Соло | Уровень: 1        │   │
│  │ Здоровье: ████████░░ 80/100     │   │
│  │ Энергия: ███████░░░ 70/100      │   │
│  │ Человечность: ██████░░░░ 60/100 │   │
│  │                                  │   │
│  │ Характеристики:                  │   │
│  │ Сила: 5 | Ловкость: 6           │   │
│  │ Интеллект: 4 | Техника: 5       │   │
│  │ Холоднокровие: 5                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ЛОКАЦИЯ                          │   │
│  │ Night City - Downtown            │   │
│  │ Район: Корпоративный центр       │   │
│  │ Опасность: Низкая                │   │
│  │                                  │   │
│  │ Вы стоите в центре корпоративного│   │
│  │ района Night City. Вокруг вас    │   │
│  │ возвышаются небоскребы корпораций│   │
│  │ Arasaka и Militech. Неоновые     │   │
│  │ вывески мигают на стенах зданий. │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Действия] [Инвентарь] [Характеристики]│
│  [Квесты] [Карта] [Социальное]         │
│  [Торговля] [Настройки] [Выход]         │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Отображение статуса персонажа (здоровье, энергия, человечность)
- Отображение характеристик персонажа
- Отображение текущей локации с текстовым описанием
- Быстрый доступ к основным функциям
- Индикатор игрового времени

---

### 1.3. Меню действий в локации

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ДОСТУПНЫЕ ДЕЙСТВИЯ                  │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Осмотреть окружение]            │   │
│  │ [Поговорить с NPC]               │   │
│  │ [Переместиться]                  │   │
│  │ [Отдохнуть]                      │   │
│  │ [Использовать предмет]           │   │
│  │ [Хакнуть систему]                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ NPC В ЛОКАЦИИ:                   │   │
│  │ • Джейк Арчер (Торговец)         │   │
│  │ • Сара Миллер (Квестодатель)     │   │
│  │ • Виктор Вектор (Риппердок)      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ДОСТУПНЫЕ ЛОКАЦИИ:               │   │
│  │ • Watson (Индустриальный район)  │   │
│  │ • Westbrook (Богатый район)     │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Назад]                                │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Список доступных действий в текущей локации
- Список NPC в локации (с возможностью взаимодействия)
- Список доступных локаций для перемещения
- Возврат в главное меню

---

## 2. Боевая система D&D формата

### 2.1. Концепция боевой системы

**Основные принципы:**
- Боевая система работает на основе кубиков (dice rolls), как в D&D
- Все действия в бою имеют вероятность успеха/неудачи
- Характеристики персонажа влияют на броски кубиков
- Оружие и снаряжение влияют на модификаторы бросков
- Каждое действие требует броска кубика (d20 или другой)

**Типы кубиков:**
- **d20** (1-20) - основной кубик для проверок действий
- **d12** (1-12) - для урона некоторых типов оружия
- **d10** (1-10) - для урона некоторых типов оружия
- **d8** (1-8) - для урона некоторых типов оружия
- **d6** (1-6) - для урона некоторых типов оружия
- **d4** (1-4) - для урона некоторых типов оружия

---

### 2.2. Механика бросков кубиков

**Базовый бросок:**
- Игрок выбирает действие (атака, защита, использование навыка)
- Система генерирует случайное число (бросок кубика)
- К броску добавляются модификаторы от характеристик
- Результат сравнивается с целевым числом (DC - Difficulty Class)

**Формула броска:**
```
Результат = Бросок кубика (d20) + Модификатор характеристики + Модификатор оружия/снаряжения + Бонусы
```

**Примеры модификаторов:**
- **Сила (STR):** Модификатор = (STR - 10) / 2 (округление вниз)
  - STR 5 = модификатор -2
  - STR 10 = модификатор 0
  - STR 15 = модификатор +2
  - STR 20 = модификатор +5

- **Ловкость (REF):** Модификатор = (REF - 10) / 2
  - Используется для атак оружием, уклонений, инициативы

- **Интеллект (INT):** Модификатор = (INT - 10) / 2
  - Используется для хакерства, использования технологий

- **Техника (TECH):** Модификатор = (TECH - 10) / 2
  - Используется для ремонта, использования сложных устройств

- **Холоднокровие (COOL):** Модификатор = (COOL - 10) / 2
  - Используется для критических попаданий, стелс-атак

---

### 2.3. Боевые действия

#### 2.3.1. Атака оружием

**Механика:**
1. Игрок выбирает оружие и цель
2. Бросок d20 для попадания
3. К броску добавляются модификаторы:
   - Модификатор Ловкости (REF) - для стрелкового оружия
   - Модификатор Силы (STR) - для ближнего оружия
   - Бонус оружия (зависит от качества оружия)
   - Бонусы от имплантов/навыков
4. Результат сравнивается с AC (Armor Class) врага
5. Если результат >= AC врага - попадание
6. Если попадание - бросок кубика урона оружия

**Пример:**
```
Игрок атакует пистолетом (урон d6+2)
Характеристики: REF 6 → модификатор -2
Бросок на попадание: d20 = 12
Результат: 12 + (-2) + 0 (базовое оружие) = 10
AC врага: 12
Результат: ПРОМАХ (10 < 12)
```

**Пример попадания:**
```
Игрок атакует пистолетом (урон d6+2)
Характеристики: REF 6 → модификатор -2
Бросок на попадание: d20 = 15
Результат: 15 + (-2) + 0 = 13
AC врага: 12
Результат: ПОПАДАНИЕ (13 >= 12)

Бросок урона: d6 = 4
Итоговый урон: 4 + 2 = 6 урона
```

---

#### 2.3.2. Критическое попадание

**Механика:**
- Если бросок на попадание = 20 (натуральная 20) - критическое попадание
- Урон удваивается
- Игнорирует часть брони врага

**Пример:**
```
Игрок атакует пистолетом
Бросок на попадание: d20 = 20 (КРИТИЧЕСКОЕ!)
Результат: КРИТИЧЕСКОЕ ПОПАДАНИЕ

Бросок урона: d6 = 5
Базовый урон: 5 + 2 = 7
Критический урон: 7 × 2 = 14 урона
```

---

#### 2.3.3. Критический промах

**Механика:**
- Если бросок на попадание = 1 (натуральная 1) - критический промах
- Атака автоматически промахивается
- Возможны дополнительные негативные эффекты (оружие заклинило, потеря баланса)

---

#### 2.3.4. Защита / Уклонение

**Механика:**
1. Враг атакует игрока
2. Игрок может попытаться уклониться (если есть действие)
3. Бросок d20 для уклонения
4. К броску добавляются модификаторы:
   - Модификатор Ловкости (REF)
   - Бонусы от брони/имплантов
5. Результат сравнивается с результатом атаки врага
6. Если результат уклонения >= результат атаки - уклонение успешно

**Пример:**
```
Враг атакует игрока
Результат атаки врага: 15
Игрок пытается уклониться
Характеристики: REF 6 → модификатор -2
Бросок на уклонение: d20 = 14
Результат: 14 + (-2) + 1 (броня) = 13
Результат: ПРОМАХ ВРАГА (13 < 15, но враг все равно попадает)
```

---

#### 2.3.5. Использование навыков

**Механика:**
- Хакерство, использование технологий, ремонт - требуют проверки навыков
- Бросок d20 + модификатор соответствующей характеристики
- Результат сравнивается с DC (Difficulty Class) задачи

**Примеры:**
- **Хакерство:** d20 + модификатор INT + бонусы от кибердеки
  - DC для простого взлома: 10
  - DC для сложного взлома: 15
  - DC для очень сложного взлома: 20

- **Ремонт:** d20 + модификатор TECH + бонусы от инструментов
  - DC для простого ремонта: 10
  - DC для сложного ремонта: 15

---

### 2.4. Интерфейс боя

#### 2.4.1. Начало боя

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     БОЙ НАЧАЛСЯ!                         │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ВАШ ПЕРСОНАЖ                     │   │
│  │ Здоровье: ████████░░ 80/100     │   │
│  │ Энергия: ███████░░░ 70/100      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ВРАГ: Бандит                    │   │
│  │ Здоровье: ██████████ 100/100   │   │
│  │ AC: 12                          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Атаковать] [Защищаться] [Использовать]│
│  [Убежать] [Инвентарь]                 │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.2. Выбор действия в бою

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ВАШ ХОД                             │
│                                         │
│  Выберите действие:                     │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Атака оружием]                 │   │
│  │ • Пистолет (d6+2 урон)         │   │
│  │ • Нож (d4+1 урон)               │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Защита]                        │   │
│  │ • Принять защитную позицию      │   │
│  │ • Уклониться                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Использовать предмет]          │   │
│  │ • Медипак (восстановление +50)  │   │
│  │ • Стимулятор (энергия +30)      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ [Использовать навык]            │   │
│  │ • Хакерство                     │   │
│  │ • Ремонт                        │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Убежать] [Отмена]                     │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.3. Результат действия в бою

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     РЕЗУЛЬТАТ ДЕЙСТВИЯ                   │
│                                         │
│  Вы атакуете пистолетом!                │
│                                         │
│  Бросок на попадание: d20 = 15          │
│  Модификатор Ловкости (REF 6): -2       │
│  Итоговый результат: 13                 │
│                                         │
│  AC врага: 12                           │
│                                         │
│  ✅ ПОПАДАНИЕ!                          │
│                                         │
│  Бросок урона: d6 = 4                   │
│  Базовый урон оружия: +2                │
│  Итоговый урон: 6                       │
│                                         │
│  Враг получает 6 урона!                 │
│  Здоровье врага: 94/100                 │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Пример промаха:**

```
┌─────────────────────────────────────────┐
│     РЕЗУЛЬТАТ ДЕЙСТВИЯ                   │
│                                         │
│  Вы атакуете пистолетом!                │
│                                         │
│  Бросок на попадание: d20 = 8           │
│  Модификатор Ловкости (REF 6): -2       │
│  Итоговый результат: 6                  │
│                                         │
│  AC врага: 12                           │
│                                         │
│  ❌ ПРОМАХ!                             │
│                                         │
│  Выстрел не попал в цель.               │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Пример критического попадания:**

```
┌─────────────────────────────────────────┐
│     РЕЗУЛЬТАТ ДЕЙСТВИЯ                   │
│                                         │
│  Вы атакуете пистолетом!                │
│                                         │
│  Бросок на попадание: d20 = 20 ⚡       │
│  Модификатор Ловкости (REF 6): -2       │
│                                         │
│  ⚡ КРИТИЧЕСКОЕ ПОПАДАНИЕ! ⚡           │
│                                         │
│  Бросок урона: d6 = 5                   │
│  Базовый урон оружия: +2                │
│  Базовый урон: 7                        │
│  Критический множитель: ×2              │
│  Итоговый урон: 14                      │
│                                         │
│  Враг получает 14 урона!                │
│  Здоровье врага: 86/100                 │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.4. Ход врага

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     ХОД ВРАГА                           │
│                                         │
│  Бандит атакует вас!                    │
│                                         │
│  Бросок на попадание: d20 = 14          │
│  Результат атаки врага: 14              │
│                                         │
│  Ваш AC: 12                             │
│                                         │
│  ⚠️ ВРАГ ПОПАДАЕТ!                     │
│                                         │
│  Бросок урона: d6 = 3                   │
│  Урон врага: 3                          │
│                                         │
│  Вы получаете 3 урона!                  │
│  Здоровье: 77/100                       │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

---

#### 2.4.5. Конец боя

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│     БОЙ ЗАВЕРШЕН!                       │
│                                         │
│  ✅ ВРАГ ПОВЕРЖЕН!                     │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ НАГРАДЫ:                         │   │
│  │ • Опыт: +100 XP                 │   │
│  │ • Деньги: +50 eddies             │   │
│  │ • Лут:                           │   │
│  │   - Компоненты (x3)              │   │
│  │   - Медипак (x1)                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Забрать лут] [Продолжить]            │
│                                         │
└─────────────────────────────────────────┘
```

---

### 2.5. Инициатива (порядок ходов)

**Правила:**
- В начале боя каждый участник бросает инициативу: d20 + модификатор REF.
- Равенство значений: ходит первым тот, у кого выше REF; если снова равенство — переголосовка d20.
- Порядок фиксируется на бой, но может пересчитываться при «Ошеломлении» или особых эффектах.

**UI шага инициативы:**
```
┌─────────────────────────────────────────┐
│     ОПРЕДЕЛЕНИЕ ИНИЦИАТИВЫ               │
│                                         │
│  Ваш бросок: d20 = 11, мод. REF (-2)   │
│  Итог: 9                               │
│                                         │
│  Бандит 1: d20 = 8, мод. REF (-1) → 7  │
│  Бандит 2: d20 = 6, мод. REF (-1) → 5  │
│                                         │
│  Порядок: Игрок → Бандит 1 → Бандит 2   │
│                                         │
│  [Продолжить]                           │
└─────────────────────────────────────────┘
```

---

### 2.6. Преимущества и помехи (advantage/disadvantage)

**Источники преимущества:**
- Враг под «Подавлением», вы в укрытии; благоприятная позиция/высота.
- Сюрприз (стелс), подсветка цели (имплант/сканер).

**Источники помехи:**
- «Ошеломление»/«Кровотечение» у вас; цель в плотном укрытии/дыме.

**Правило броска:**
- Преимущество: бросить два d20 и взять лучший результат.
- Помеха: бросить два d20 и взять худший результат.
- Если оба одновременно — взаимно гасятся (обычный d20).

**UI:** показывать метку Advantage/Disadvantage и оба значения бросков.

```
Бросок на попадание: d20 = 7, d20 = 15 (Advantage) → взят 15
Итог: 15 + модификаторы = 13 → ПОПАДАНИЕ
```

---

### 2.7. Состояния (conditions)

**Базовые состояния (MVP):**
- Ошеломление: −2 к броскам атаки/уклонения, нет реакций до конца текущего раунда.
- Кровотечение: 2 урона в конце хода; снимается медипаком/лечением.
- Подавление: атаки с помехой до выхода в укрытие или прекращения огня.
- Паника: проверки COOL и атаки с помехой один раунд.

**Наложение и снятие:**
- Повторное наложение продлевает длительность, штраф не стакается (берется максимальный).
- Снятие: медипак (кровотечение), укрытие (подавление), успешная проверка COOL (паника), истечение длительности (ошеломление).

**UI:** иконки состояний рядом с HP, всплывающие подсказки; в логе — строки о начале/окончании.

```
Состояние применено: Кровотечение (2 урона в конце хода)
Состояние снято: Кровотечение (использован медипак)
```

---

## 3. Технические требования

### 3.1. API Endpoints для боя

**POST /api/v1/combat/start**
- Начать бой с врагом
- Request: `{ "characterId": "uuid", "enemyId": "uuid", "locationId": "uuid" }`
- Response: `{ "combatId": "uuid", "turn": "player", "status": "active" }`

**POST /api/v1/combat/{combatId}/action**
- Выполнить действие в бою
- Request: `{ "action": "attack", "weaponId": "uuid", "target": "enemy" }`
- Response: `{ "success": true, "diceRoll": 15, "result": "hit", "damage": 6, "log": "..." }`

**GET /api/v1/combat/{combatId}/status**
- Получить статус боя
- Response: `{ "status": "active", "turn": "player", "playerHealth": 80, "enemyHealth": 94 }`

**POST /api/v1/combat/{combatId}/end**
- Завершить бой (если враг повержен или игрок убежал)
- Response: `{ "victory": true, "rewards": { "experience": 100, "money": 50, "loot": [...] } }`

---

### 3.2. Механика генерации кубиков

**На сервере:**
- Генерация случайных чисел для бросков кубиков
- Использование криптографически безопасного генератора случайных чисел
- Сохранение результатов бросков в логе боя

**Формулы:**
- **d20 бросок:** `random(1, 20)`
- **d12 бросок:** `random(1, 12)`
- **d10 бросок:** `random(1, 10)`
- **d8 бросок:** `random(1, 8)`
- **d6 бросок:** `random(1, 6)`
- **d4 бросок:** `random(1, 4)`

---

### 3.3. Модификаторы характеристик

**Таблица модификаторов:**
- Характеристика 1-2: модификатор -5
- Характеристика 3-4: модификатор -4
- Характеристика 5-6: модификатор -2
- Характеристика 7-8: модификатор -1
- Характеристика 9-10: модификатор 0
- Характеристика 11-12: модификатор +1
- Характеристика 13-14: модификатор +2
- Характеристика 15-16: модификатор +3
- Характеристика 17-18: модификатор +4
- Характеристика 19-20: модификатор +5

---

## 4. Примеры игрового процесса

### 4.1. Пример боя

**Шаг 1: Игрок атакует**
```
Действие: Атака пистолетом
Бросок: d20 = 15
Модификатор REF (6): -2
Результат: 13
AC врага: 12
Результат: ПОПАДАНИЕ

Урон: d6 = 4
Базовый урон: +2
Итоговый урон: 6
Здоровье врага: 94/100
```

**Шаг 2: Враг атакует**
```
Действие врага: Атака
Бросок: d20 = 14
Результат: 14
AC игрока: 12
Результат: ПОПАДАНИЕ

Урон: d6 = 3
Здоровье игрока: 77/100
```

**Шаг 3: Игрок использует медипак**
```
Действие: Использовать медипак
Восстановление: +50
Здоровье игрока: 127/100 → 100/100 (максимум)
```

**Шаг 4: Игрок атакует (критическое попадание)**
```
Действие: Атака пистолетом
Бросок: d20 = 20 (КРИТИЧЕСКОЕ!)
Результат: КРИТИЧЕСКОЕ ПОПАДАНИЕ

Урон: d6 = 5
Базовый урон: +2 = 7
Критический урон: 7 × 2 = 14
Здоровье врага: 80/100
```

**Шаг 5: Враг повержен**
```
Враг получает финальный урон
Здоровье врага: 0/100
Результат: ВРАГ ПОВЕРЖЕН

Награды:
- Опыт: +100 XP
- Деньги: +50 eddies
- Лут: Компоненты (x3), Медипак (x1)
```

---

## 5. Начальный боевой контент

### 5.1. Второй квест: "Защита торговца"

После завершения первого квеста "Доставка груза" игрок получает второй квест, который знакомит его с боевой системой D&D формата.

**ID квеста:** `quest-merchant-defense-002`

**Название:** "Защита торговца"

**Тип:** Side quest (побочный квест)

**Уровень:** 1-2

**Данный NPC:** Рита Морено (торговец)

**Локация получения:** Watson, Night City

**Локация выполнения:** Watson, Night City

---

### 5.2. Описание квеста

**Краткое описание:**
Рита Морено просит защитить её от бандитов, которые пытаются её ограбить. Это первое боевое задание для игрока, которое знакомит с боевой системой D&D формата.

**Полное описание:**
"Чомбата, у меня проблема. Бандиты из местной банды пытаются ограбить меня. Они угрожают мне каждый день. Мне нужна защита. Если поможешь мне справиться с ними, заплачу 300 eddies и дам хорошую награду. Но будь осторожен - они вооружены и опасны. Это твой первый бой, так что будь внимателен."

---

### 5.3. Диалог с Ритой Морено (для второго квеста)

**Приветствие (после первого квеста):**
"О, ты вернулся! Спасибо за посылку. У меня есть еще одно задание для тебя, если хочешь заработать."

**Опции диалога:**

1. **"Какие еще задания у тебя есть?"**
   - **Ответ:** "Есть проблема - бандиты пытаются ограбить меня. Мне нужна защита. Если поможешь справиться с ними, заплачу 300 eddies и дам хорошую награду. Но будь осторожен - это твой первый бой."
   - **Действие:** Показывается информация о квесте "Защита торговца"

2. **"Расскажи о бандитах"**
   - **Ответ:** "Они из местной банды. Вооружены пистолетами и ножами. Не очень опытные, но опасные. Они приходят ко мне каждый день, требуют деньги. Если не заплачу - угрожают."
   - **Действие:** Показывается дополнительная информация о врагах

3. **"Принять квест"**
   - **Ответ:** "Спасибо, чомбата! Они придут сюда через несколько минут. Будь готов к бою. Если нужно, могу дать тебе базовое оружие и медикаменты."
   - **Действие:** Квест добавляется в активные квесты, игрок получает базовое оружие (если его нет)

---

### 5.4. Цели квеста (Objectives)

**1. Принять квест от Риты Морено**
- **Тип:** NPC interaction
- **Цель:** Рита Морено (npc-rita-moreno)
- **Описание:** "Принять квест от Риты Морено"
- **Действие:** Игрок выбирает опцию "Принять квест" в диалоге

**2. Подготовиться к бою**
- **Тип:** Preparation
- **Цель:** Проверить инвентарь, убедиться что есть оружие и медикаменты
- **Описание:** "Подготовиться к бою - проверить оружие и медикаменты"
- **Действие:** Игрок открывает инвентарь, проверяет оружие и медикаменты
- **Примечание:** Если у игрока нет оружия, Рита Морено может дать базовое оружие (пистолет или нож)

**3. Встретить бандитов**
- **Тип:** Combat trigger
- **Цель:** Бандиты появляются в локации
- **Описание:** "Встретить бандитов в локации"
- **Действие:** Игрок находится в локации Watson, бандиты появляются через несколько минут (или сразу после подготовки)

**4. Победить бандитов в бою**
- **Тип:** Combat
- **Цель:** Победить всех бандитов (1-2 бандита для первого боя)
- **Описание:** "Победить всех бандитов в бою"
- **Действие:** Игрок вступает в бой с бандитами, используя боевую систему D&D формата

**5. Завершить квест**
- **Тип:** Quest completion
- **Цель:** Рита Морено (npc-rita-moreno)
- **Описание:** "Вернуться к Рите Морено и завершить квест"
- **Действие:** Игрок возвращается к Рите Морено после боя, завершает квест

---

### 5.5. Первый бой: Встреча с бандитами

#### 5.5.1. Начало боя

**Сценарий:**
После принятия квеста игрок ждет в локации Watson (или бандиты появляются сразу после подготовки). Бандиты появляются и начинают угрожать Рите Морено.

**Текстовая сцена:**
```
Бандиты появляются из-за угла. Двое бандитов приближаются к Рите Морено.

"Эй, старуха! Где наши деньги? Ты не заплатила нам сегодня!"

Рита Морено: "Чомбата, помоги мне! Они вооружены!"

Бандиты замечают вас.

"Эй, ты кто такой? Не лезь не в свое дело, если не хочешь получить проблем!"

Вы можете:
- [Попытаться договориться] (проверка COOL, DC 15)
- [Атаковать бандитов] (начать бой)
- [Убежать] (завершить квест провалом)
```

**Если игрок выбирает "Атаковать бандитов":**
```
Бой начинается! Вы готовы сражаться.

Бандиты агрессивны и готовы к бою. Они вооружены пистолетами и ножами.

"Ты пожалеешь об этом!"
```

**Системные действия:**
- Бой начинается
- Создается боевая сессия (combat session)
- Определяется инициатива (кто ходит первым)
- Показывается интерфейс боя

---

#### 5.5.2. Враги в первом бою

**Враг 1: Бандит (уровень 1)**

**Характеристики:**
- **Здоровье:** 60/60
- **AC (Armor Class):** 12
- **Оружие:** Пистолет (урон d6+1)
- **Броня:** Базовая броня (AC +0)
- **Характеристики:**
  - STR: 6 (-2 модификатор)
  - REF: 8 (-1 модификатор)
  - INT: 5 (-2 модификатор)
  - TECH: 5 (-2 модификатор)
  - COOL: 6 (-2 модификатор)

**Описание:**
"Обычный бандит, вооруженный пистолетом. Не очень опытный боец, но опасный в ближнем бою."

**Тактика:**
- Атакует игрока пистолетом
- Если здоровье < 30, может попытаться убежать или использовать медикамент

**Враг 2: Бандит (уровень 1)** - опционально, если игрок легко справляется

**Характеристики:**
- **Здоровье:** 50/50
- **AC (Armor Class):** 11
- **Оружие:** Нож (урон d4+1)
- **Броня:** Без брони (AC +0)
- **Характеристики:**
  - STR: 7 (-1 модификатор)
  - REF: 7 (-1 модификатор)
  - INT: 4 (-3 модификатор)
  - TECH: 4 (-3 модификатор)
  - COOL: 5 (-2 модификатор)

**Описание:**
"Бандит с ножом, менее опытный чем первый. Атакует в ближнем бою."

**Тактика:**
- Атакует игрока ножом в ближнем бою
- Если здоровье < 25, может попытаться убежать

---

#### 5.5.3. Пример боевого сценария (пошаговый)

**Шаг 1: Определение инициативы**

```
┌─────────────────────────────────────────┐
│     ОПРЕДЕЛЕНИЕ ИНИЦИАТИВЫ               │
│                                         │
│  Бросок инициативы:                     │
│  - Ваш бросок: d20 = 12                 │
│    Модификатор REF (6): -2              │
│    Итоговая инициатива: 10              │
│                                         │
│  - Бандит 1 бросок: d20 = 8             │
│    Модификатор REF (8): -1              │
│    Итоговая инициатива: 7               │
│                                         │
│  ✅ ВЫ ХОДИТЕ ПЕРВЫМ!                   │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Шаг 2: Ход игрока - Атака пистолетом**

```
┌─────────────────────────────────────────┐
│     ВАШ ХОД                             │
│                                         │
│  Вы атакуете бандита пистолетом!       │
│                                         │
│  Бросок на попадание: d20 = 15          │
│  Модификатор Ловкости (REF 6): -2       │
│  Бонус оружия: +0                       │
│  Итоговый результат: 13                │
│                                         │
│  AC бандита: 12                         │
│                                         │
│  ✅ ПОПАДАНИЕ!                          │
│                                         │
│  Бросок урона: d6 = 4                   │
│  Базовый урон оружия: +2                │
│  Итоговый урон: 6                       │
│                                         │
│  Бандит получает 6 урона!               │
│  Здоровье бандита: 54/60                │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Шаг 3: Ход врага - Атака бандита**

```
┌─────────────────────────────────────────┐
│     ХОД ВРАГА                           │
│                                         │
│  Бандит атакует вас пистолетом!        │
│                                         │
│  Бросок на попадание: d20 = 14          │
│  Модификатор Ловкости (REF 8): -1       │
│  Итоговый результат: 13                │
│                                         │
│  Ваш AC: 12                             │
│                                         │
│  ⚠️ ВРАГ ПОПАДАЕТ!                     │
│                                         │
│  Бросок урона: d6 = 3                   │
│  Базовый урон оружия: +1                │
│  Итоговый урон: 4                       │
│                                         │
│  Вы получаете 4 урона!                  │
│  Здоровье: 76/100                       │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Шаг 4: Продолжение боя - Критическое попадание**

```
┌─────────────────────────────────────────┐
│     ВАШ ХОД                             │
│                                         │
│  Вы атакуете бандита пистолетом!       │
│                                         │
│  Бросок на попадание: d20 = 20 ⚡       │
│  Модификатор Ловкости (REF 6): -2       │
│                                         │
│  ⚡ КРИТИЧЕСКОЕ ПОПАДАНИЕ! ⚡           │
│                                         │
│  Бросок урона: d6 = 5                   │
│  Базовый урон оружия: +2                │
│  Базовый урон: 7                        │
│  Критический множитель: ×2              │
│  Итоговый урон: 14                      │
│                                         │
│  Бандит получает 14 урона!             │
│  Здоровье бандита: 40/60               │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Шаг 5: Использование медикамента**

```
┌─────────────────────────────────────────┐
│     ВАШ ХОД                             │
│                                         │
│  Вы используете медипак!               │
│                                         │
│  Восстановление здоровья: +50           │
│                                         │
│  Здоровье: 100/100 (максимум)          │
│                                         │
│  Медипак использован (1 осталось)      │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**Шаг 6: Победа над врагом**

```
┌─────────────────────────────────────────┐
│     БОЙ ЗАВЕРШЕН!                       │
│                                         │
│  ✅ ВРАГ ПОВЕРЖЕН!                     │
│                                         │
│  Бандит получает финальный урон.       │
│  Здоровье бандита: 0/60                │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ НАГРАДЫ:                         │   │
│  │ • Опыт: +150 XP                 │   │
│  │ • Деньги: +100 eddies            │   │
│  │ • Лут:                           │   │
│  │   - Компоненты (x2)              │   │
│  │   - Медипак (x1)                 │   │
│  │   - Патроны (x10)                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [Забрать лут] [Продолжить]            │
│                                         │
└─────────────────────────────────────────┘
```

---

### 5.6. Завершение квеста

**После победы в бою:**

```
Рита Морено: "Спасибо, чомбата! Ты спас меня от бандитов. Вот твоя награда."

Вы получаете:
- Опыт: +150 XP
- Деньги: +300 eddies (от Риты Морено)
- Деньги: +100 eddies (лут с бандитов)
- Лут: Компоненты (x2), Медипак (x1), Патроны (x10)
- Репутация: +5 (Watson торговцы)
```

**Диалог с Ритой Морено после боя:**

**Приветствие:**
"Спасибо, чомбата! Ты спас меня. Бандиты больше не будут меня беспокоить. Вот твоя награда."

**Опции диалога:**

1. **"Расскажи о бандитах"**
   - **Ответ:** "Они были из местной банды. Не очень опытные, но опасные. Теперь они знают, что со мной не стоит связываться."

2. **"Какие еще задания у тебя есть?"**
   - **Ответ:** "Сейчас у меня нет других заданий, но если появятся - обязательно найду тебя. Ты зарекомендовал себя как надежный наемник."

3. **"До свидания"**
   - **Ответ:** "Удачи, чомбата. Заходи еще. Если нужно оружие или броня - обращайся."

---

### 5.7. Награды за квест

**Опыт:** 150 XP

**Деньги:** 400 eddies (300 от Риты Морено + 100 с бандитов)

**Предметы:**
- Компоненты (x2)
- Медипак (x1)
- Патроны (x10)

**Репутация:**
- Фракция: Watson торговцы
- Количество: +5

**Дополнительные бонусы:**
- Разблокировка дополнительных квестов от Риты Морено
- Разблокировка торговли с другими торговцами в Watson
- Первое знакомство с боевой системой D&D формата

---

### 5.8. Обучение боевой системе в первом бою

**Подсказки во время первого боя:**

**При начале боя:**
```
┌─────────────────────────────────────────┐
│     ПОДСКАЗКА: БОЕВАЯ СИСТЕМА           │
│                                         │
│  Это твой первый бой!                  │
│                                         │
│  Боевая система работает на основе     │
│  кубиков (D&D формат):                  │
│  - Бросок d20 определяет попадание     │
│  - К броску добавляются модификаторы    │
│    от характеристик                    │
│  - Результат сравнивается с AC врага   │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**При первом попадании:**
```
┌─────────────────────────────────────────┐
│     ПОДСКАЗКА: ПОПАДАНИЕ                │
│                                         │
│  ✅ Вы попали!                          │
│                                         │
│  Если результат броска >= AC врага,     │
│  атака попадает. Затем бросается кубик │
│  урона оружия.                          │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**При первом промахе:**
```
┌─────────────────────────────────────────┐
│     ПОДСКАЗКА: ПРОМАХ                   │
│                                         │
│  ❌ Вы промахнулись!                   │
│                                         │
│  Если результат броска < AC врага,     │
│  атака не попадает. Попробуйте еще раз! │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**При критическом попадании:**
```
┌─────────────────────────────────────────┐
│     ПОДСКАЗКА: КРИТИЧЕСКОЕ ПОПАДАНИЕ    │
│                                         │
│  ⚡ КРИТИЧЕСКОЕ ПОПАДАНИЕ! ⚡          │
│                                         │
│  Если бросок = 20, это критическое    │
│  попадание! Урон удваивается.          │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

**При использовании медикамента:**
```
┌─────────────────────────────────────────┐
│     ПОДСКАЗКА: МЕДИКАМЕНТЫ             │
│                                         │
│  Вы использовали медипак!              │
│                                         │
│  Медикаменты восстанавливают здоровье. │
│  Используйте их осторожно - они          │
│  ограничены в количестве.               │
│                                         │
│  [Продолжить]                           │
│                                         │
└─────────────────────────────────────────┘
```

---

### 5.9. Обработка поражения в первом бою

**Если игрок проигрывает бой:**

```
┌─────────────────────────────────────────┐
│     БОЙ ЗАВЕРШЕН                        │
│                                         │
│  ❌ ВЫ ПРОИГРАЛИ                        │
│                                         │
│  Бандиты оказались сильнее. Вы         │
│  теряете сознание и оказываетесь в      │
│  медицинском центре.                    │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ПОТЕРИ:                          │   │
│  │ • Деньги: -50 eddies             │   │
│  │ • Опыт: -25 XP                   │   │
│  │ • Лут: потерян (если был)        │   │
│  └─────────────────────────────────┘   │
│                                         │
│  Квест не завершен. Вы можете попробовать│
│  снова, когда будете готовы.           │
│                                         │
│  [Вернуться в локацию]                 │
│                                         │
└─────────────────────────────────────────┘
```

**Альтернативный вариант:**
- Игрок может вернуться к Рите Морено и попросить помощь (получить лучшее оружие/броню)
- Игрок может попробовать снова после улучшения характеристик
- Квест остается активным, пока игрок не победит или не откажется от квеста

---

### 5.10. Последовательность выполнения боевого квеста

**Шаг 1: Принятие квеста**
1. Игрок возвращается к Рите Морено после первого квеста
2. Игрок начинает диалог
3. Игрок выбирает опцию "Какие еще задания у тебя есть?"
4. Игрок видит информацию о квесте "Защита торговца"
5. Игрок выбирает "Принять квест"
6. Квест добавляется в активные квесты
7. Игрок получает базовое оружие (если его нет)

**Шаг 2: Подготовка к бою**
1. Игрок открывает инвентарь
2. Игрок проверяет оружие и медикаменты
3. Игрок готовится к бою

**Шаг 3: Встреча с бандитами**
1. Бандиты появляются в локации (или сразу после подготовки)
2. Игрок видит текстовую сцену с бандитами
3. Игрок выбирает действие (атаковать/договориться/убежать)
4. Если игрок выбирает "Атаковать" - начинается бой

**Шаг 4: Бой**
1. Бой начинается
2. Определяется инициатива
3. Игрок и враги ходят по очереди
4. Игрок использует боевую систему D&D формата (броски кубиков, модификаторы)
5. Бой продолжается до победы или поражения

**Шаг 5: Победа**
1. Игрок побеждает бандитов
2. Игрок получает награды (опыт, деньги, лут)
3. Игрок видит сообщение о победе

**Шаг 6: Завершение квеста**
1. Игрок возвращается к Рите Морено
2. Игрок начинает диалог
3. Квест автоматически завершается (или игрок выбирает опцию "Завершить квест")
4. Игрок получает финальные награды
5. Квест удаляется из активных квестов

---

### 5.11. Интеграция с туториалом

**Если туториал включен:**

**Этап 11: Знакомство с боевой системой (5-10 минут)**

**Цель:** Познакомить игрока с боевой системой D&D формата

**Элементы обучения:**
- **Начало боя:** Объяснение интерфейса боя
- **Броски кубиков:** Объяснение системы бросков d20
- **Модификаторы:** Объяснение модификаторов характеристик
- **AC (Armor Class):** Объяснение системы защиты
- **Урон:** Объяснение системы урона
- **Критические попадания:** Объяснение критических попаданий
- **Медикаменты:** Объяснение использования медикаментов

**Подсказки:**
- "Это твой первый бой! Боевая система работает на основе кубиков (D&D формат)."
- "Бросок d20 определяет попадание. К броску добавляются модификаторы от характеристик."
- "Результат сравнивается с AC врага. Если результат >= AC, атака попадает."
- "Если бросок = 20, это критическое попадание! Урон удваивается."
- "Используйте медикаменты осторожно - они ограничены в количестве."

**Действия игрока:**
- Изучить интерфейс боя
- Выполнить первую атаку
- Посмотреть результат броска кубика
- Понять систему модификаторов
- Использовать медикамент (если нужно)
- Победить врага

---

## 6. Связанные документы

- [Основной интерфейс](./ui-main-game.md) - детальное описание основного интерфейса
- [API Endpoints](./api-requirements/mvp-endpoints.md) - детальные API endpoints
- [Модели данных](./api-requirements/mvp-data-models.md) - модель Combat

---

## 6. TODO

**TODO:** Добавить больше вариантов действий в бою (специальные атаки, способности) - требуется для разнообразия.

**TODO:** Добавить больше специальных действий (прицельный выстрел, подавляющий огонь, бросок гранаты).

---

## История изменений

- v1.0.0 (2025-11-04) - Создание документа с описанием начала игры и боевой системы D&D формата
- v1.1.0 (2025-11-05) - Добавлен раздел "Начальный боевой контент" с описанием второго квеста "Защита торговца", первого боя с бандитами, обучения боевой системе D&D формата и интеграции с туториалом

