# Система отношений с NPC

**api-readiness:** review  
**api-readiness-check-date:** 2025-11-03  
**api-readiness-notes:** Документ детальный, содержит конкретные механики для API. TODO блоки только по балансировке (не блокируют создание API). Требуется проверка готовности.

**Статус:** review - проверка готовности к созданию API задач  
**Приоритет:** Высокий  
**Дата создания:** 2025-11-03

---

## Концепция системы отношений с NPC

### Важность системы отношений с NPC

**Почему важны:**
- В игре будет 100+ важных NPC
- Глубокие отношения создают живой мир с реальными последствиями
- Романтика и дружба добавляют эмоциональную глубину
- Игроки могут стать частью мира для других игроков (вдохновение: KENSHI)
- Влияние класса и фракции на отношения добавляет глубину

**Источники вдохновения:**
- **BALDUR GATE 3** - глубокие романтические отношения с персонажами, развитие отношений
- **The Witcher 3** - романтические отношения с персонажами, влияние выборов
- **KENSHI** - игроки становятся частью мира для других игроков
- **Cyberpunk 2077** - отношения с NPC, влияние репутации и фракций

---

## Полная система отношений с NPC

### 1. Базовые отношения (Friends/Enemies)

**Типы базовых отношений:**
- **Друзья (Friends)** - положительные отношения с NPC
  - Доступ к квестам и ресурсам
  - Скидки у торговцев
  - Помощь в конфликтах
  - Информация и советы
- **Враги (Enemies)** - отрицательные отношения с NPC
  - Блокировка доступа к квестам
  - Высокие цены у торговцев
  - Агрессивное поведение
  - Блокировка информации

### 2. Система репутации с NPC (NPC Reputation System)

**Шкала репутации: -100 до +100**
- **-100 до -50: Враждебность (Hostile)**
  - Агрессивное поведение NPC
  - Блокировка всех взаимодействий
  - Возможность нападения
  - Блокировка квестов и ресурсов
- **-50 до -10: Неприязнь (Unfriendly)**
  - Отрицательное отношение
  - Ограничения на взаимодействие
  - Высокие цены
  - Предупреждения при встрече
- **-10 до +10: Нейтралитет (Neutral)**
  - Нейтральное отношение
  - Стандартные цены и доступ
  - Базовые взаимодействия
- **+10 до +50: Дружба (Friendship)**
  - Положительное отношение
  - Скидки у торговцев
  - Доступ к дополнительным квестам
  - Помощь в операциях
- **+50 до +100: Союзник (Ally)**
  - Максимальное доверие
  - Максимальные скидки и бонусы
  - Доступ к эксклюзивному контенту
  - Совместные операции

**TODO:** Балансировка уровней репутации с NPC и их эффектов будет сделана позже:
- Точные пороговые значения для каждого уровня
- Конкретные бонусы и штрафы для каждого уровня
- Механика изменения репутации (точные значения за действия)
- Балансировка скорости изменения репутации

### 3. Влияние класса на отношения с NPC

**Механика влияния класса:**
- **Solo (Соло)** - бонусы к отношениям с боевыми NPC (наемники, солдаты)
- **Netrunner (Нетраннер)** - бонусы к отношениям с техническими NPC (хакеры, инженеры)
- **Fixer (Фиксер)** - бонусы к отношениям с торговыми NPC (торговцы, брокеры)
- **Rockerboy (Рокербой)** - бонусы к отношениям с социальными NPC (музыканты, активисты)
- **Media (Медиа)** - бонусы к отношениям с информационными NPC (журналисты, информаторы)
- **Nomad (Кочевник)** - бонусы к отношениям с кочевыми NPC (кочевники, водители)
- **Corpo (Корпорат)** - бонусы к отношениям с корпоративными NPC (менеджеры, аналитики)
- **Lawman (Законник)** - бонусы к отношениям с правовыми NPC (полиция, детективы)
- **Medtech (Медтех)** - бонусы к отношениям с медицинскими NPC (медики, кибердоки)
- **Techie (Техник)** - бонусы к отношениям с техническими NPC (инженеры, механики)
- **Politician (Политик)** - бонусы к отношениям с политическими NPC (политики, дипломаты)
- **Trader (Торговец)** - бонусы к отношениям с экономическими NPC (торговцы, инвесторы)
- **Teacher (Учитель)** - бонусы к отношениям с образовательными NPC (преподаватели, наставники)

**Штрафы класса:**
- **Solo** - штрафы к отношениям с мирными NPC (некоторые торговцы, гражданские)
- **Netrunner** - штрафы к отношениям с корпоративными NPC (опасность хакерства)
- **Fixer** - штрафы к отношениям с правовыми NPC (криминальные связи)
- **Rockerboy** - штрафы к отношениям с корпоративными NPC (антикорпоративный настрой)
- **Media** - штрафы к отношениям с корпоративными NPC (раскрытие информации)
- **Lawman** - штрафы к отношениям с криминальными NPC (банды, контрабандисты)

**TODO:** Балансировка влияния класса на отношения с NPC будет сделана позже:
- Точные значения бонусов и штрафов для каждого класса
- Балансировка влияния на разные типы NPC
- Комбинация влияний нескольких классов (если игрок сменил класс)

### 4. Влияние фракции на отношения с NPC

**Механика влияния фракции:**
- **Репутация игрока с фракцией NPC** влияет на отношения с NPC этой фракции
- **Враждующие фракции** - штрафы к отношениям с NPC вражеских фракций
- **Союзные фракции** - бонусы к отношениям с NPC союзных фракций
- **Нейтральные фракции** - нейтральное отношение к NPC нейтральных фракций

**Примеры влияния:**
- Игрок с высокой репутацией у **Arasaka** → бонусы к отношениям с NPC Arasaka
- Игрок с высокой репутацией у **Arasaka** → штрафы к отношениям с NPC **Militech** (враги)
- Игрок с высокой репутацией у **Maelstrom** → штрафы к отношениям с NPC **Полиция** (враги)
- Игрок с высокой репутацией у **Maelstrom** → бонусы к отношениям с NPC **Valentinos** (если союзники)

**TODO:** Балансировка влияния фракции на отношения с NPC будет сделана позже:
- Точные значения бонусов и штрафов для разных уровней репутации
- Веса влияния фракционной репутации на отношения с NPC
- Балансировка влияния враждующих/союзных фракций

### 5. Типы отношений с NPC

#### 5.1. Дружба (Friendship)

**Уровни дружбы:**
- **Знакомый (Acquaintance)** - базовое знакомство
- **Друг (Friend)** - дружеские отношения
- **Лучший друг (Best Friend)** - близкие дружеские отношения
- **Семья (Family)** - семейные отношения (если есть)

**Механика дружбы:**
- Развитие дружбы через совместные операции
- Подарки и помощь друзьям
- Доступ к личным квестам друзей
- Помощь в конфликтах

**TODO:** Балансировка системы дружбы будет сделана позже:
- Условия для каждого уровня дружбы
- Механика развития дружбы (точные значения)
- Влияние дружбы на доступ к контенту

#### 5.2. Романтика (Romance)

**Уровни романтических отношений:**
- **Флирт (Flirting)** - начальная стадия романтических отношений
- **Свидания (Dating)** - развитие романтических отношений
- **Романтика (Romance)** - полноценные романтические отношения
- **Партнерство (Partnership)** - долгосрочные отношения

**Доступность NPC для романтики:**
- **Доступен (Available)** - NPC доступен для романтических отношений
- **Занят (Taken)** - NPC уже в романтических отношениях с другим игроком или NPC
- **Недоступен (Unavailable)** - NPC не может быть в романтических отношениях (по лору или характеристикам)

**Условия для начала романтики:**
- NPC должен быть **Доступен** для романтики
- Репутация игрока с NPC должна быть **очень высокой** (порог крайне велик)
- Дружба с NPC должна быть на высоком уровне
- Выполнение специальных романтических квестов и выборов
- Множественные положительные взаимодействия

**Высокий порог для романтики:**
- **Минимальная репутация:** +80 до +100 (зависит от NPC)
- **Минимальная дружба:** Лучший друг или выше
- **Требования:** Выполнение специальных романтических квестов
- **Выборы:** Правильные романтические выборы в диалогах
- **Время:** Длительное развитие отношений

**Особенности высокой планки:**
- Очень сложно добиться романтики с NPC
- Требуется много усилий и времени
- Не все NPC могут быть в романтических отношениях
- Романтика с NPC - престижная и редкая возможность

**Механика романтики:**
- Развитие романтических отношений через выборы и действия
- Романтические квесты и события
- Влияние романтических отношений на сюжет
- Возможность иметь несколько романтических отношений (если NPC согласны и NPC свободны)

**Особенности:**
- Романтические отношения могут влиять на доступ к контенту
- Романтические партнеры могут помогать в операциях
- Развитие отношений через диалоги и выборы
- Разрыв отношений может иметь серьезные последствия

#### 5.2.1. Эмоции NPC в романтических отношениях

**Система эмоций NPC:**
- NPC могут **расстраиваться** из-за действий игрока
- NPC могут **рассердиться** из-за предательства или плохих выборов
- NPC могут **зависеть** от внимания игрока (отсутствие внимания вызывает расстройство)
- NPC могут **ревновать** к другим романтическим отношениям

**Типы действий, вызывающих расстройство:**
- **Отсутствие внимания** - игрок долго не взаимодействует с NPC
- **Предательство** - действия, противоречащие отношениям
- **Плохие выборы** - выборы, которые не нравятся NPC
- **Игнорирование** - игнорирование просьб или событий NPC
- **Другие романтические отношения** - ревность к другим романтическим партнерам

**Последствия расстройства NPC:**
- Снижение репутации и дружбы
- Возможность разрыва романтических отношений
- Блокировка доступа к романтическим квестам
- Негативное отношение NPC к игроку
- Влияние на сюжет и доступ к контенту

**Механика восстановления отношений:**
- Извинения и попытки исправить ситуацию
- Подарки и внимание
- Выполнение специальных квестов для восстановления
- Время для восстановления отношений

**TODO:** Балансировка системы романтики будет сделана позже:
- Условия для каждого уровня романтических отношений
- Точный порог репутации и дружбы для начала романтики (крайне высокий)
- Механика развития романтики (точные значения)
- Механика расстройства NPC (триггеры, последствия, восстановление)
- Влияние романтики на сюжет и доступ к контенту
- Балансировка полигамных отношений
- Балансировка механики отсутствия внимания (как долго, сколько раз)

#### 5.3. Вражда (Enmity)

**Типы враждебности:**
- **Конкуренция (Competition)** - соперничество за ресурсы/цели
- **Неприязнь (Dislike)** - отрицательное отношение без агрессии
- **Ненависть (Hatred)** - сильная враждебность
- **Месть (Vengeance)** - стремление к мести за действия

**Механика враждебности:**
- Враждебность может возникнуть из-за действий игрока
- Враждебные NPC могут нападать или саботировать действия игрока
- Враждебность может передаваться союзникам NPC
- Возможность разрешения конфликтов через диалог/действия

**TODO:** Балансировка системы враждебности будет сделана позже:
- Условия для каждого типа враждебности
- Механика развития враждебности (точные значения)
- Влияние враждебности на поведение NPC
- Возможности разрешения конфликтов

#### 5.4. Специальные отношения (Special Relationships)

**Типы специальных отношений:**
- **Наставничество (Mentorship)** - отношения учитель-ученик
  - Учитель (Teacher класс) может наставлять NPC
  - NPC может наставлять игрока
  - Обучение навыкам и знаниям
- **Семья (Family)** - семейные отношения
  - Члены семьи NPC
  - Влияние отношений с семьей на отношения с NPC
- **Клан (Clan)** - отношения с кланом NPC
  - Члены клана NPC
  - Влияние отношений с кланом на отношения с NPC
- **Деловые отношения (Business)** - профессиональные отношения
  - Работодатель-работник
  - Партнеры по бизнесу
  - Конкуренты

**TODO:** Балансировка специальных отношений будет сделана позже:
- Условия для каждого типа специальных отношений
- Механика развития специальных отношений
- Влияние специальных отношений на доступ к контенту

---

## Игроки как NPC (Players as NPCs)

### Концепция

**Идея:** Игроки могут выполнять роли NPC для других игроков, становясь частью мира (вдохновение: KENSHI)

**Механика:**
- Игроки могут выполнять различные роли NPC
- Игроки могут нанимать NPC для выполнения ролей
- Игроки могут получать заказы от других игроков как NPC

### 1. Роли, которые могут выполнять игроки

**Типы ролей NPC:**
- **Торговец (Merchant)** - продажа товаров и ресурсов другим игрокам
- **Фиксер (Fixer)** - организация заказов и контрактов для других игроков
- **Тренер (Trainer)** - обучение других игроков навыкам (Teacher класс)
- **Квестодатель (Quest Giver)** - предоставление заданий другим игрокам
- **Информатор (Informer)** - продажа информации другим игрокам
- **Наемник (Mercenary)** - предоставление боевых услуг другим игрокам
- **Телохранитель (Bodyguard)** - защита других игроков
- **Дипломат (Diplomat)** - переговоры и дипломатия для других игроков (Politician класс)

**Механика выполнения роли:**
- Игрок выбирает роль NPC для выполнения
- Игрок настраивает параметры роли (цены, условия, требования)
- Другие игроки могут взаимодействовать с игроком как с NPC
- Игрок получает вознаграждение за выполнение роли

**TODO:** Балансировка механики игроков как NPC будет сделана позже:
- Балансировка вознаграждений за выполнение ролей NPC
- Балансировка требований для выполнения различных ролей
- Балансировка влияния класса на доступные роли

### 2. Найм NPC для выполнения ролей

**Концепция:** Игроки могут нанимать NPC для выполнения ролей, которые обычно выполняют игроки

**Типы найма NPC:**
- **Торговец** - наем NPC для торговли товарами и ресурсами
- **Квестодатель** - наем NPC для предоставления заданий другим игрокам
- **Фиксер** - наем NPC для организации заказов и контрактов
- **Телохранитель** - наем NPC для защиты игрока
- **Наемник** - наем NPC для боевых операций
- **Дипломат** - наем NPC для переговоров и дипломатии

**Механика найма:**
- Игрок выбирает NPC для найма
- Игрок настраивает параметры найма (задачи, вознаграждение, условия)
- NPC выполняет роль согласно настройкам
- Игрок получает часть выгоды от работы нанятого NPC

**Особенности:**
- Наем NPC требует ресурсов и времени
- NPC имеет свои навыки и ограничения
- Наем может быть временным или постоянным
- Взаимоотношения с NPC влияют на эффективность найма

**TODO:** Балансировка механики найма NPC будет сделана позже:
- Балансировка стоимости найма NPC
- Балансировка эффективности нанятых NPC
- Балансировка влияния взаимоотношений на найм
- Балансировка ограничений и требований найма

### 3. Игроки дают заказы как NPC

**Концепция:** Игроки могут размещать заказы, которые выполняют другие игроки или NPC

**Типы заказов от игроков:**
- **Боевые заказы** - задания на устранение целей, защиту, рейды
- **Хакерские заказы** - задания на взлом, сбор информации, саботаж
- **Торговые заказы** - задания на поставку товаров, транспортировку
- **Политические заказы** - задания на влияние, дипломатию, интриги
- **Исследовательские заказы** - задания на исследование, разработку технологий

**Механика размещения заказов:**
- Игрок размещает заказ через систему контрактов
- Игрок устанавливает условия и вознаграждение
- Другие игроки или NPC могут принять заказ
- Игрок получает результат выполнения заказа

**Особенности:**
- Игрок может размещать заказы как NPC (через своего нанятого NPC или напрямую)
- Заказы могут быть публичными или приватными
- Заказы могут быть для конкретных игроков или фракций
- Заказы влияют на репутацию игрока

**TODO:** Балансировка механики размещения заказов игроками будет сделана позже:
- Балансировка стоимости размещения заказов
- Балансировка вознаграждений за выполнение заказов
- Балансировка влияния заказов на репутацию
- Балансировка эффективности заказов через NPC

---

## Влияние на игровой мир

### Механики влияния

**Отношения с NPC влияют на:**
- Доступ к квестам и заданиям
- Цены торговцев и доступность товаров
- Поведение NPC и их союзников
- Доступ к территориям и ресурсам
- Развитие сюжета и ветвление квестов
- Взаимоотношения с фракциями
- Экономику и торговлю

**TODO:** Балансировка влияния отношений с NPC на игровой мир будет сделана позже:
- Конкретные эффекты для каждого уровня отношений
- Влияние на цены и доступность товаров (точные проценты)
- Влияние на поведение NPC (уровни агрессии, дружелюбия)
- Влияние на доступ к территориям (критерии доступа)

---

## Решения

### Полная система отношений с NPC

**Решение (2025-11-03):** Полная система отношений с NPC (комбинация)
- **Базовые отношения:** Друзья/Враги
- **Репутация:** Система репутации с NPC (-100 до +100)
- **Влияние класса:** Бонусы и штрафы к отношениям с NPC в зависимости от класса
- **Влияние фракции:** Влияние репутации с фракцией на отношения с NPC фракции
- **Типы отношений:** Дружба, Романтика, Вражда, Специальные отношения (Наставничество, Семья, Клан, Деловые)
- **Игроки как NPC:** Игроки могут выполнять роли NPC для других игроков
- **Наем NPC:** Игроки могут нанимать NPC для выполнения ролей
- **Заказы от игроков:** Игроки могут размещать заказы как NPC

**Сложность системы:**
- Очень сложная система отношений
- Множество факторов влияния (класс, фракция, действия)
- Глубокие последствия для всех действий
- Игроки как часть мира для других игроков

---

## Вопросы для проработки

1. ✅ Как работают отношения с NPC? - **Определена полная система: Базовые отношения, Репутация, Влияние класса и фракции, Типы отношений, Игроки как NPC**
2. ✅ Как работают игроки как NPC? - **Определена механика: Игроки могут выполнять роли NPC, нанимать NPC, размещать заказы**
3. ✅ Как работают романтические отношения с NPC? - **Определена полная система: Доступность NPC, Высокий порог для романтики, Уровни романтических отношений, Эмоции NPC (расстройство из-за действий или отсутствия внимания), Восстановление отношений**
4. ✅ Как работает система наставничества? - **Определена полная система: Типы наставничества (Игрок→Игрок, Игрок→NPC, NPC→Игрок, NPC→NPC), Механика обучения, Уникальные способности Teacher класса, Влияние на отношения**
5. ✅ Как работает система семейных отношений? - **Определена полная система: Типы членов семьи, Типы семейных связей, Влияние на отношения, Механика, Особые механики (Усыновление, Семейные конфликты)**
6. ✅ Как работает система найма NPC? - **Определена полная система: Типы найма, Процесс найма, Управление, Экономика, Эффективность, Ограничения**
7. ✅ Как работают заказы от игроков через NPC? - **Определена полная система: Типы заказов, Процесс создания и выполнения, Заказы через NPC, Экономика, Репутация, Специальные механики**

---

## История изменений

- v1.0.0 (2025-11-03) - Создан документ системы отношений с NPC
- v1.1.0 (2025-11-03) - Определена полная система отношений с NPC
  - Система репутации с NPC
  - Влияние класса и фракции на отношения с NPC
  - Типы отношений: Дружба, Романтика, Вражда, Специальные отношения
  - Механика игроков как NPC (выполнение ролей NPC для других игроков)
  - Механика найма NPC для выполнения ролей
  - Механика размещения заказов игроками как NPC
- v1.2.0 (2025-11-03) - Добавлены детали романтической системы
  - Доступность NPC для романтики (Доступен/Занят/Недоступен)
  - Крайне высокий порог для начала романтики (репутация +80-100, дружба на высоком уровне)
  - Система эмоций NPC в романтических отношениях (расстройство из-за действий игрока или отсутствия внимания)
  - Механика восстановления отношений после расстройства
  - Последствия расстройства NPC (снижение репутации, возможный разрыв отношений)

