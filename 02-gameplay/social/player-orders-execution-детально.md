# Система заказов — выполнение заказа (детально)

**Статус:** draft  \
**Версия:** 0.1.0  \
**Дата создания:** 2025-11-07  \
**Последнее обновление:** 2025-11-07  \
**Приоритет:** высокий

**api-readiness:** needs-work  \
**api-readiness-check-date:** 2025-11-07 21:32  \
**api-readiness-notes:** Требуются формулы распределения наград по чекпоинтам и UX-мокапы прогресс-трекинга.

---

## 1. Общий пайплайн выполнения

- Принятие → Подготовка → Активная фаза → Подтверждение чекпоинтов → Сдача доказательств → Верификация → Выплата.
- Оркестрация через `social-service`; `economy-service` управляет escrow и выплатами; `npc-service` отслеживает участие NPC.

---

## 2. Принятие и старт

- **Acceptance Ticket:** фиксирует исполнителя, состав команды, стартовое время.
- **Escrow Lock:** резервирует средства (10–30%) в `economy-service`.
- **Brief Sync:** автоматический чек на совпадение условий (из `player-orders-creation-детально.md`).

---

## 3. Подготовка

- Конфигурация слотов (игроки/NPC), назначение ролей.
- Запрос ресурсов: транспорт, оборудование, разрешения (`world-service`).
- Предзагрузка модулей: карты, нейродоступ, AR-инструкции.
- Формирование плана чекпоинтов (см. раздел 4).

---

## 4. Чекпоинты выполнения

- **Типы:**
  - Narrative (диалоги, достижения целей).
  - Combat (уничтожение целей, удержание точек).
  - Stealth/Hacking (взлом, внедрение).
  - Logistics (доставка, эвакуация).
- **Структура чекпоинта:** ID, описание, дедлайн, ответственные, вес в награде, тип доказательства.
- **FSM статусы:** pending → active → submitted → verified → failed.
- **Автоматизация:** `gameplay-service` и `world-service` могут закрывать чекпоинты автоматически при триггерах.

---

## 5. Доказательства выполнения

- **Форматы:**
  - Телеметрия боя (боевые журналы, kill-feed).
  - Видеофрагменты/скриншоты (AR маркировка).
  - Логи взлома, дампы сетей.
  - Инвентарные подтверждения (предметы, кредиты).
  - Свидетельства NPC (рапорты от `npc-service`).
- **Требования:** привязка к чекпоинту, контроль подлинности, время фиксации.
- **Хранение:** `content-service`, доступ по ссылкам в карточке заказа.

---

## 6. Прогресс-трекинг и UX

- **UI:** шкала прогресса, список чекпоинтов с цветовой кодировкой.
- **Push-уведомления:** старт/окончание чекпоинта, запрос дополнительного доказательства, задержки.
- **Коммуникация:** встроенный канал чата/voice, лог задач.
- **Analytics:** итоговый отчёт с KPI, временем, потерями.

---

## 7. Верификация и сдача

- `social-service` агрегирует доказательства, запускает проверку.
- **Auto-verify:** при совпадении телеметрии и чекпоинта.
- **Manual review:** модератор (игрок/ NPC) проверяет материалы; срок по умолчанию — 12 часов.
- **Partial Success:** допускается, если закрыта доля чекпоинтов ≥ порога (обычно 70%).

---

## 8. Арбитраж

- Триггеры: спор по доказательствам, просрочка дедлайна, нарушение условий.
- **Arbitration Board:** NPC-организация; использует правила из `player-orders-reputation-детально.md`.
- **Процесс:** сбор дополнительных материалов → решение (approve/reject/redo) → автоматическое обновление рейтингов.
- **Санкции:** штрафы, потеря депозита, временные блокировки публикации/участия.
- **Эскалация:** фракционные суды (`factions-service`) или мировые трибуналы (`world-service`) для крупных корп. заказов.

---

## 9. Выплаты и распределение

- `economy-service` освобождает escrow после верификации.
- **Распределение:**
  - По чекпоинтам (вес → процент награды).
  - Бонусы за досрочное выполнение.
  - Штрафы за задержку (процент удержания).
- Поддержка мультивалютных выплат, долей NPC, налогов фракций.

---

## 10. Санкции и последствия

- **Исполнитель:** снижение рейтинга, удержание депозита, фракционные штрафы, бан на типы заказов.
- **Заказчик:** повышение комиссий, заморозка escrow, потеря приоритета в выдаче заказов.
- **Команда:** отдельное логирование для каждого участника, связь с `relationships-system-детально.md`.

---

## 11. Интеграции

- `player-orders-creation-детально.md` — бриф и подготовка.
- `player-orders-reputation-детально.md` — влияние на рейтинги.
- `player-orders-economy.md` (будущий детальный файл) — формулы выплат.
- `npc-hiring-system-детально.md` — участие наёмных NPC.
- `relationships-system-детально.md` — доверие между участниками.

---

## 12. Требуется доработка

- Формализация формул распределения награды и штрафов.
- UX-мокап карточки прогресса, экраны арбитража.
- Спецификация API-точек: /orders/{id}/checkpoints, /orders/{id}/evidence, /orders/{id}/arbitration.


