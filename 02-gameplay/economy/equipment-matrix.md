# Процедурная матрица снаряжения (оружие/импланты/экипировка)

**Статус:** draft  
**Версия:** 0.1.0  
**Дата создания:** 2025-11-03  
**Приоритет:** высокий

**api-readiness:** needs-work  
**api-readiness-check-date:** 2025-11-03  
**api-readiness-notes:** Приняты решения G1–G7, требуется схема данных, список характеристик по типам предметов и правила генерации.

---

## Цель

Сформировать каркас процедурной генерации предметов в стиле Borderlands: бренды/фракции + базовый каркас характеристик + аффиксы/моды + редкость/сид-генерация + связь с крафтом/рынком/имплантами.

## Решения высокого уровня (G1–G7)

1. **Бренды/фракционная привязка (G1):** Комбинация — лорные бренды как ядро, авторские расширяют, пользовательские через жёсткий модерационный пайплайн.

2. **Каркас характеристик (G2):** Комбинация — ядро статов + модульные расширения под тип предмета (оружие/броня/импланты/кибердеки и т.д.).

3. **Модификаторы/аффиксы (G3):** Комбинация — простые статы, сетовые/синергийные (бренд/фракция/класс), уникальные эффекты; уровни редкости влияют на силу/слоты.

4. **Редкость и генерация (G4):** Комбинация — фиксированные уровни редкости + взвешенная генерация (зоны/TTK/лига) + сиды для воспроизводимости.

5. **Крафт и реролл (G5):** Комбинация — дроп + крафт из компонентов + реролл/перековка с ограничениями (себестоимость, лицензии, риск ухудшения).

6. **Связь с имплантами/киберпсихозом (G6):** Комбинация — совместимость/штрафы, энергобюджет/перегрев, влияние на риск киберпсихоза.

7. **Экономика и рынки (G7):** Комбинация — рынки, аукцион/тендеры высоких редкостей, контракты на заказные сборки (бренд/аффиксы/требования).

---

## Каркас данных (черновик)

- ItemBase { id, type, brandId, rarity, seed, level, zoneTag }
- StatsCore { damage, rof, accuracy, recoil, weight, durability }
- StatsExtended { damageType, penetration, noise, heatGen, energyUse, hackResist, heatDissipation, implantCompat }
- Affix { id, kind: simple|set|unique, tags, values, conditions }
- Brand { id, name, factionId?, signatureBonuses, visualStyle }
- GenerationRules { rarityWeightsByZone, affixPoolsByType, constraints, seedPolicy }
- Crafting { recipeId, components, facilities, licenses, risks }

---

## Типы предметов и их характеристики (черновик)

1) Оружие (пистолет, ПП, штурмовая, дробовик, снайперка, тяжёлое)
- Ядро: damage, rof, accuracy, recoil, magSize, reloadTime
- Расширения: damageType, penetration, noise, heatGen, energyUse, hipfirePenalty, adsBonus, handling
- Синергии: implantCompat, cyberdeckSlots?, brandSignature

2) Броня/экипировка (торс, голова, руки, ноги)
- Ядро: armor, durability, weight, mobilityPenalty
- Расширения: resistances (phys/emp/thermal/chem), noiseDamp, heatDissipation, energyBuffer
- Слоты модов: optics/plates/rigs/utility

3) Импланты (боевые/тактические/защитные/двигательные/OS)
- Ядро: slotType, energyDrain, heatGen, compatLevel, rarity
- Расширения: abilityPower, cooldownMod, statMultipliers, hackResist, humanityImpact
- Особое: synergyTags (weaponClass, deckLevel, brand), maintenanceCost

4) Кибердеки
- Ядро: quickhackSlots, deckEnergy, regenRate, ioBandwidth
- Расширения: overheatThreshold, iceBypass, signalDistance, detectionFootprint
- Связь: cyberpsychosisRiskFactor (от перегрева/нагрузки)

5) Модификации/аугменты (моды ствола, прицелы, пластины, охлаждение)
- Ядро: slot, statDelta, drawbacks
- Расширения: conditionalProcs, setBonuses, brandLock

Примечание: для каждого типа предмета характеристики модульны — активируются только релевантные поля.

---

## Интеграции

- Фракции/бренды: `03-lore/factions/factions-overview.md`
- Локации/TTK/зоны: `03-lore/locations/locations-overview.md`, `02-gameplay/combat/*`
- Импланты/киберпсихоз: `02-gameplay/combat/combat-implants.md`
- Экономика/крафт/торговля: `02-gameplay/economy/economy-overview.md`, `economy-crafting.md`, `economy-trading.md`, `economy-monetization.md`

---

## Бренды и сигнатуры (лор + авторские + пользовательские)

### Лорные бренды (ядро)
- Arasaka — smart/сетевые системы, точность/скрытность; сигнатуры: smartLock, hackIntegration, lowNoise
- Militech — power/tech вооружение, бронепробитие/надёжность; сигнатуры: penetration+, recoilStability, ruggedness
- Kang Tao — smart-оружие масс-сегмента, управляемость; сигнатуры: smartAssist, handling+, lightweight
- Tsunami Defense — премиум-точность и дальность; сигнатуры: accuracy++, ADSBonus, lowRecoil
- Budget/Constitutional/Federated Arms — массовый рынок, дешёвые апгрейды; сигнатуры: costEfficiency, easyModding
- Kiroshi (оптика) — крит/восприятие; сигнатуры: critScope, detection+, glareReduce
- Zetatech / Biotechnica / Dynalar — кибервар/импланты; сигнатуры: energyOpt, heatDissipation, compat+

### Авторские бренды (по регионам/лигам)
- Borealis Heavy (Европа) — тяжёлое оружие/броня; сигнатуры: armor+, suppression, overheatResist
- Shinka Dynamics (Азия) — лёгкие платформы/дроны; сигнатуры: mobility+, ioBandwidth, signalStealth
- NuevoSol (Америка) — логистика/штурмовые; сигнатуры: magSize+, reload-, convoyPerks
- VolgaTek (СНГ) — гибридные тех-решения; сигнатуры: repairEase, durability+, retrofitCompat

### Пользовательские бренды (жёсткий пайплайн)
- Review: визуал/лор, баланс-лимиты, сигнатуры из разрешённых пулов
- Ограничения: допустимые affix-теги, caps по статам/прокам, региональные квоты
- Маркетплейс: публикация за депозит, отзыв/патчи по жалобам

### Сигнатуры → маппинг на данные
- brand.signatureBonuses → пресеты для StatsCore/StatsExtended/Affix-пулов
- brandLock/setBonuses → использование Affix.kind set|unique
- region/league gates → rarityWeightsByZone, constraints

---
## TODO

- Уточнить пул базовых и расширенных характеристик по типам предметов
- Сформировать набор брендов (лорные/авторские) и их сигнатуры; прописать пайплайн пользовательских
- Описать генератор (веса, сиды, совместимость, ограничения)
- Определить контракты заказных сборок и лицензии на реролл

## История изменений

- v0.1.0 (2025-11-03) — создан каркас и зафиксированы решения G1–G7

---

## Правила генерации (черновик)

### 1. Редкость
- Уровни: common, uncommon, rare, epic, legendary, artifact
- Влияние редкости: количество слотов аффиксов, сила диапазонов, шанс уникальных/сетовых эффектов

### 2. Веса по контексту
- Зоны/TTK: более опасные зоны → более высокий вес редкостей; PvE/PvP/экстракт различаются пулами
- Лига/стадия: поздние стадии лиги поднимают потолок редкости и усиливают сигнатуры брендов
- Регион/фракция: локальные бренды/аффиксы получают бонус-веса; санкции/блокировки снижают вес

### 3. Сид-политика
- item.seed формируется из: (brandId, zoneTag, leagueId, rarity, rollIdx)
- Детализация: одинаковый seed → воспроизводимые статы/аффиксы в пределах версии генератора
- Версионирование генератора: seedVersion в GenerationRules для обратной совместимости

### 4. Совместимость и ограничения
- Имплант-совместимость: implantCompat и synergyTags фильтруют/взвешивают доступные аффиксы
- Энергобюджет/перегрев: energyUse+heatGen не должны превышать лимиты билда/имплантов/деки
- Киберпсихоз-риск: при превышении порогов heat/energy повышается риск (см. combat-implants)

### 5. Фракционные/брендовые модификаторы
- brand.signatureBonuses применяются как пресеты к пулам аффиксов/статов
- factionControl в зоне добавляет временные модификаторы весов/редкостей/аффиксов
- Сет-эффекты: при 2+/3+ предметах одного бренда активируются setBonuses (ограничения баланса)

### 6. Алгоритм (высокий уровень)
1) Выбор редкости (с учётом весов: зона/TTK/лига/фракция)
2) Выбор бренда (локальные веса + пользовательские ограничения)
3) Генерация базовых статов (StatsCore) по seed и типу предмета
4) Применение расширений (StatsExtended) и проверка лимитов energy/heat
5) Роллинг аффиксов (simple→set→unique по шансам редкости)
6) Применение сигнатур бренда/фракции и сет-бонусов
7) Валидация совместимости/ограничений → при фейле переролл аффикса/понижение редкости

### 7. Анти-абуз и баланс
- caps по ключевым статам на редкость/лигу/режим
- запрет некоторых комбинаций аффиксов/сигнатур
- лимиты на количество «уникальных» эффектов в билде

---

## Примечания баланса
- Все веса и лимиты — данные, управляемые конфигом лиги; изменения через патчи без смены кода
- Пользовательские бренды наследуют глобальные caps и не могут добавлять новые типы уник-эффектов без ревью

---

## Крафт и реролл (каркас)

### 1. Крафт
- Источники рецептов: лут/квесты/взлом сетей/рынки/фракции
- Рецепт: список компонентов, требования к станции/лицензии, минимальная репутация
- Качество результата: зависит от редкости компонентов, станции, лицензии, навыков
- Фракционные модификаторы: бонусы/штрафы по зонам контроля, налоги/пошлины

### 2. Реролл/перековка
- Режимы: частичный реролл (аффиксы), полный реролл (все аффиксы), калибровка (узкие диапазоны)
- Издержки: компоненты/валюта/лицензии + риск ухудшения/поломки при многократных попытках
- Ограничения: caps по числу рероллов за лигу/предмет; уникальные эффекты не рероллятся или требуют спец‑лицензий

### 3. Лицензии и доступ
- Грейды лицензий: L1→L3 (уровни доступных редкостей/аффиксов)
- Получение: фракции/рынки/контракты/сертификация
- Аудит: логи операций, влияние на репутацию/страхование

### 4. Контракты заказных сборок
- Клиент формирует ТЗ: бренд/диапазоны статов/аффиксы/бюджет/сроки
- Исполнитель: игрок/клан/фракция с нужными лицензиями/станциями
- Модель оплаты: аванс + escrow + бонусы за KPI (качество/срок)

### 5. Интеграция с экономикой
- Аукционы для высоких редкостей; тендеры на партии
- Страхование на время контракта доставки/сборки
- Санкции при нарушении условий (см. фракционная экономика)

---

## Рынки, аукционы и заказные сборки (каркас)

### 1) Рынки
- Локальные/региональные рынки: налоги/пошлины/квоты зависят от фракций
- Биржевые лоты: стандартные товары/ресурсы/компоненты с глубиной стакана
- Фильтры матрицы: brand/type/rarity/affixes/compat/seedRange

### 2) Аукционы
- Форматы: английский/голландский/закрытые заявки
- Область: предметы редкости ≥ epic; артефакты — только аукцион/тендер
- Защита: депозиты/эскроу/страхование на доставку

### 3) Тендеры/контракты
- Серии поставок: объём/период/цена-ступени (SLAs на срок/качество)
- KPI и санкции: штрафы/репутация/чёрные списки (см. фракции E2/E5)
- Фракционные преференции: приоритеты доступа и скидки

### 4) Заказные сборки
- Конфигуратор ТЗ: бренд, цели статов (диапазоны), аффиксы, совместимость/энергобюджет
- Исполнители: фильтр по лицензиям/репутации/станциям
- Логистика: окна/эскорт/страхование доставки (см. LGT1–LGT7)

---

## Контракты поставок (серии, SLA, санкции)

### Модель контракта
- Параметры: объём (шт/партии), периодичность (дни/недели), спецификация (brand/type/rarity/диапазоны статов/аффиксы), цена/ступени, гарантии
- SLA: сроки поставки, качество (минимальные ролл-диапазоны/совместимость/энергобюджет), процент брака
- Гарантии: эскроу/депозит, страхование на логистику и производство

### Исполнение
- Трекинг: вехи (milestones), KPI (срок/качество/процент брака), авто‑штрафы
- Замены: допоставки при браке/дефектах, частичный реролл за счёт исполнителя (при наличии лицензии)
- Аудит: логи производства/доставки, подписи станций/лицензий

### Санкции и репутация
- Штрафы: фикс/процент от партии, удержание из эскроу
- Репутация: снижение standing на рынках/у фракций, риск чёрных списков
- Эскалация: расторжение контракта, блокировки (см. фракции E2), судебный арбитраж (системный)

---

## Динамическое ценообразование и фракционное влияние
- Налоги/пошлины/квоты фракций (см. E1–E5) влияют на цены рынков, стартовые цены аукционов, пороги тендеров
- Контроль зон повышает/понижает rarityWeightsByZone и стоимость логистики/страхования
- Санкции/блокировки (E2) увеличивают наценки или закрывают доступ; репутация (E7) даёт скидки/страховки/порог участия

---

## Пайплайн пользовательских брендов (review/moderation)

1) Заявка
- Пакет: визуал (логотип/скины), лор-описание, сигнатуры (из разрешённых пулов), набор допустимых аффикс‑тегов
- Автоматические проверки: caps по статам/прокам, конфликтующие эффекты, соответствие зонам/лигам

2) Модерация
- Этапы: автоматический скоринг → ревью баланс‑командой → тестовый выпуск (ограниченные партии/лига)
- Метрики: жалобы/винрейт/цены/частота дропа/доля рынка

3) Паблиш и сопровождение
- Публикация в маркетплейсе за депозит; версия бренда/сигнатур фиксируется
- Горизонтальная правка: нерф/баф только через минор‑версии с уведомлениями; возможен временный оффлайн

4) Санкции и ответственность
- Нарушения: скрытые сигнатуры, обход caps, манипуляции рынком → штрафы/заморозка бренда/чёрный список
- Возвраты: эскроу отрабатывает компенсации при откатах версий

