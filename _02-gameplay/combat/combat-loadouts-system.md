# Боевая система — Loadouts и комплекты

**api-readiness:** draft  
**api-readiness-check-date:** 2025-11-08 00:05  
**api-readiness-notes:** Требуется детализация API контрактов и UX прототипов для управления loadouts, текущее описание — концепт.  
**target-domain:** gameplay-combat  
**target-microservice:** gameplay-service (port 8083)  
**target-frontend-module:** modules/combat/loadouts  
**Статус:** draft - первичная проработка  
**Приоритет:** Высокий  
**Дата создания:** 2025-11-08  
**Версия:** 0.2.0

---

## Цели системы Loadouts

- Давать игроку до 10 преднастроенных боевых конфигураций, чтобы быстро переключаться между ролями, режимами и сценариями.
- Объединять экипировку, способности, импланты, навыки, гаджеты, кибердеку и расходники в единое целое.
- Обеспечесать совместимость с микро-сервисной архитектурой: хранение и валидация на `gameplay-service`, синхронизация с `economy-service` и `social-service`.
- Упростить матчмейкинг и подготовку к рейдам, аренам, экстракциям, PvP/PvE событиям.

---

## Ключевые определения

- **Loadout (Лодаут):** сохранённый набор всех боевых параметров персонажа, который можно активировать перед матчем или в безопасной зоне.
- **Комплект (Kit):** связка внутри лодаута, объединяющая конкретный тип сущностей (пример: оружейный комплект, имплант-комплект, кибердек-комплект). Комплекты можно переиспользовать между лодаутами.
- **Активный лодаут:** текущая конфигурация персонажа.
- **Резервные лодауты:** сохранённые конфигурации, которые можно быстро активировать.
- **Глобальные пресеты:** типовые лодауты от фракций/корпораций, выдаваемые за прогресс, события, сезоны.

---

## Ограничения и слоты

- **Количество:** базово 3 слота лодаутов, расширение до 10 через прогрессию (уровень репутации, фракционные квесты, премиальные сервисы).
- **Группировка:** лодауты делятся на категории — PvE-рейды, PvP-арена, Экстракция, Стелс, Кибервойна. Категория влияет на доступные комплекты и рекомендуемые пресеты.
- **Лимиты пересохранения:** в бою запрещено менять комплекты, в безопасной зоне — без ограничения, в экстракции — только через мобильные станции.
- **Привязка к классам:** каждый лодаут хранит выбранную боевую роль (`combat-roles-detailed.md`) и проверяет совместимость навыков и имплантов.
- **Синхронизация:** при смене лодаута система валидирует вес/энергию/перегрев, проверяет наличие предметов в инвентаре и доступность навыков.

---

## Структура лодаута

1. **Экипировочный комплект**
   - Основное и дополнительное оружие (с модами, брендовыми сигнатурами).
   - Броня и щиты (вкл. сетовые бонусы).
   - Тактические гаджеты (дроны, турели, ловушки).
2. **Комплект способностей**
   - Слоты Q/E/R + два дополнительных активных слота для гибридных билдов.
   - Пассивные способности и перки.
   - Расход ресурсов (энергия, здоровье, боеприпасы способностей).
3. **Имплант-комплект**
   - Слоты по типам (боевые, тактические, защитные, двигатель, операционная система).
   - Энергетический бюджет, лимиты человечности, риск киберпсихоза.
4. **Комплект навыков и прокачки**
   - Поддерево очков навыков, активируемое с лодаутом (выбор ветки, распределение очков).
   - Умения классовых линий, которые зависят от выбранной роли.
5. **Кибердек-комплект**
   - Слоты программ взлома (5 активных, 5 запасных).
   - Настройки защиты, протоколы быстрого взлома, триггеры AI-помощника.
6. **Комплект расходников**
   - Мед-гели, стимы, гранаты, батареи имплантов.
   - Ограничение по весу и количеству.
7. **Транспорт/дрон-комплект**
   - Персональные дроны, мех-существа, экзо-скелеты, их моды и командные режимы.

Каждый комплект имеет независимый шаблон и версию. Изменение комплекта обновляет все лодауты, в которых он используется, с логом изменений.

---

## Комплекты и переиспользование

- **Личная библиотека:** игрок хранит комплекты отдельно и комбинирует их в лодауты.
- **Фракционные комплекты:** выдаются фракциями, имеют ограничения по изменению (пример: `Arasaka Black Ops`).
- **Корпоративные бренды:** интеграция с `economy/equipment` — брендовые бонусы активируются, если комплект собран полностью.
- **Командные комплекты:** лидер отряда может рекомендовать стандартизированные комплекты для рейда; члены отряда получают временный доступ.
- **Рынок:** возможность обмениваться комплектами (через рецепты/планы) внутри `economy-service` с валидацией авторских прав.

---

## Loadouts для навыков и способностей

- **Гибридная сетка:** каждая роль имеет базовый набор слотов навыков и дополнительных гибридных слотов, доступных через импланты или прогрессию.
- **Сохранение распределения:** при активации лодаута автоматически применяются выбранные пассивы и очки в поддеревьях.
- **Синергия с имплантами:** определённые импланты автоматически активируют/деактивируют навыки.
- **Макрофункции:** игрок создаёт макрокоманды (например, «стелс-комбо»), привязанные к конкретному набору способностей и гаджетов.
- **Вариативность:** поддержка минимум 4 типов ability-loadouts — штурм, поддержка, кибервойна, разведка.

---

## Управление лодаутами

- **Создание:** пошаговый мастер (выбор роли → выбор категории → добавление комплектов → проверка лимитов → сохранение).
- **Редактирование:** режим изменения конкретного комплекта или всей конфигурации; история версий с откатом.
- **Активирование:** через безопасные зоны, мобильные станции, командный интерфейс перед матчем; отображаются требования режима.
- **UI:** вкладки по категориям, визуализация энергобюджета, веса, синергий. Использование компонентов `shared/ui/CyberpunkTabs`, `shared/ui/LoadoutCard`.
- **Совместимость:** система автоматически подсвечивает несовместимые элементы и предлагает альтернативы.

---

## Прогрессия и монетизация

- **Разблокировка слотов:** уровень персонажа, репутация, достижения, подписки корпораций.
- **Расширенные комплекты:** премиум-слоты для дополнительного набора гаджетов или уникальных имплантов (балансируется ограничениями).
- **Сезонные стимули:** временные лодауты, дающие бонус к прогрессу, но требующие активной игры.
- **Экономика:** крафт и сбор комплектов в `economy-service`, торговля чертежами, обслуживание имплантов.

---

## PvE экспедиции и лутинг по мотивам ARC Raiders

- **Экстракшн-петля:** лодауты должны поддерживать полный цикл «высадка → зачистка → эвакуация». Перед вылетом игрок выбирает профиль (ударный, разведывательный, эвакуационный) и соответствующий комплект, влияющий на бонусы при выходе с добычей.
- **Динамические условия карты:** сохранение шаблонов событий вроде «Скрытый бункер», «Ночные рейды», «Электромагнитные бури». Лодауты обязаны иметь предустановки для энергетической защиты, сенсорных модулей и борьбы с помехами.
- **Модули против механических ARC:** отдельный каталог комплектов с импульсным, EMP и разрушающим оружием. Требуется проверка совместимости с имплантами, повышающими сопротивление перегреву и урону от машин.
- **Командные роли PvE:** лидер рейда назначает «Сноубрейкера» (вскрывает укрепления), «Сэйфраннера» (тащит груз) и «Штормового оператора» (держит агрессоров). Для каждой роли — рекомендованный набор умений, гаджетов и транспорта.
- **Сбор трофеев:** комплекты должны учитывать вес, объём и тип ресурса. При превышении лимита система предлагает подключить дрон-носитель или сбросить низкоценные предметы.
- **Экстренная эвакуация:** активные способности лодаута включают «эвак-маяки» и мобильные станции. Валидатор проверяет наличие необходимых расходников, аккумуляторов и доступ к сетевому каналу.
- **Риск-награда:** чем больше времени игрок проводит на карте, тем выше уровень угрозы ARC и шанс вторжения других отрядов. Лодауты получают адаптивные модификаторы — усиление щитов, снижение шума, расширение сенсоров.

---

## Интеграция с другими системами

- **Матчмейкинг:** лодауты передаются в `matchmaking-service` для подбора команд и расчёта рейтинга.
- **Социальные функции:** возможность делиться публичными лодаутами в кланах, голосовать за пресеты, назначать обязательные комплекты.
- **Прогрессия:** данные о использовании лодаутов влияют на перки, достижения и рекомендательные системы.
- **События:** специальные события требуют конкретных комплектов (например, «нулевой имплант», «хардкор»).
- **Аналитика:** логирование активности для балансировки (какие комплекты популярны, какие комбинации ломают баланс).

---

## Требования к данным и API (черновик)

- `GET /api/v1/gameplay/loadouts` — список лодаутов персонажа, фильтрация по категории.
- `POST /api/v1/gameplay/loadouts` — создание нового лодаута на основе выбранных комплектов и роли.
- `PATCH /api/v1/gameplay/loadouts/{id}` — обновление составных комплектов, история версий.
- `POST /api/v1/gameplay/loadouts/{id}/activate` — активация с проверкой условий режима.
- `GET /api/v1/gameplay/loadouts/kits` — библиотека комплектов (личные, фракционные, глобальные).
- События RabbitMQ/Kafka при активации лодаута для синхронизации с `economy-service` и `social-service`.
- Требуется схема валидации для энергии, веса, лимитов имплантов, совместимости способностей.

---

## Открытые вопросы

1. Требуются ли серверные очереди для массового обновления лодаутов при балансовых патчах?
2. Как обрабатываются лодауты, если предмет из комплекта временно недоступен (аренда, таймер, блокировка)?
3. Нужны ли ограничения на количество фракционных комплектов в одном лодауте?
4. Какой уровень кастомизации макрокоманд и пресетов допустим, чтобы не нарушать баланс?
5. Следует ли разрешать экспорт/импорт лодаутов между персонажами аккаунта?

---

## История изменений

- v0.2.0 (2025-11-07) — добавлены механики PvE экспедиций, динамических условий карт и лутинг-систем, вдохновлённых ARC Raiders.
- v0.1.0 (2025-11-08) — первичное описание системы боевых лодаутов, комплектов и интеграций.


