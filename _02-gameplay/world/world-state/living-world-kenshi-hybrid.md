---
api-readiness: needs-work
api-readiness-check-date: 2025-11-08 00:14
api-readiness-notes: Черновик гибридной системы живого мира и прокачки, вдохновленной Kenshi. Требуется детализация численных параметров, API контрактов и игровых сценариев.
---

# Living World & Use-Based Progression — Kenshi Hybrid

**Статус:** draft  
**Версия:** 0.1.0  
**Дата создания:** 2025-11-08  
**Приоритет:** высокий  
**Автор:** AI Brain Manager

**target-domain:** gameplay-world-state, gameplay-progression  
**target-microservice:** world-service (8086); gameplay-service (8083)  
**target-frontend-module:** modules/world/state, modules/progression/skills

---

## Цели

- Добавить слой симуляции живого мира, реагирующего на устранение лидеров, осаду городов и изменение союзов фракций (как в Kenshi).
- Расширить текущую систему рангов и коэффициентов навыков `progression-skills.md` за счёт «прокачки действием» и тренажёров по образцу Kenshi.
- Создать основу для процедурных историй игроков и фракций за счёт пересечения мировых событий, прогресса навыков и инфраструктуры игроков.

---

## Ключевые принципы живого мира (Kenshi)

1. **Фракционные последствия:** уничтожение ключевых NPC или отрядов меняет владельца города, запускает гражданские войны, открывает вакуум власти.
2. **Поселения и логистика:** базы генерируют патрули, сборщиков налогов, торговцев; supply/demand влияет на экономику региона.
3. **Отряды с автономией:** NPC-сквады патрулируют, нападают, перемещаются между локациями без триггеров игрока.
4. **Свободный сторителлинг:** игрок выбирает сторону, создает истории (спасение караванов, смена власти, создание собственного города).
5. **Прокачка через действия:** сила растёт от перегруза, скрытность — от передвижения рядом с врагами, взлом — от повторяющихся попыток (метод «клетка полицейского участка»).

---

## Слои симуляции

### 1. Фракционные войны и власть

- **Мировые состояния:** `world.faction.<id>.control` отражает владельца города или региона. Смена владельца запускает цепочки эвентов (блокпосты, налоги, охота на повстанцев).
- **Триггеры:** гибель лидера, серия успешных рейдов игроков, экономическое истощение (падение supply).
- **Inspirations Kenshi:** аналог Living World/Reactive World модов, где игрок или NPC решают, кто займет освободившийся город.

### 2. Поселения игроков и логистика

- **Статусы баз:** каждая база имеет уровни «тихий лагерь → аванпост → город». Порог зависит от населения, построек, экспорта ресурсов.
- **Логистические события:** патрули союзников, налёты рейдеров, налоговые инспекции, торговцы. Генерация зависит от богатства и репутации.
- **Экономический импакт:** производство ресурсов влияет на глобальные цены (подключение к `economy-world-impact.md`).

### 3. Дорожная сеть и отряды

- **Autonomous squads:** world-service генерирует NPC-отряды (караваны, мародёры, фракционные армии) с целями и временем прибытия.
- **Перехват:** игроки могут атаковать или защищать; успешные действия повышают «истории героя».
- **Telemetry:** события фиксируются в global-state, доступные фронтенду как хроника мира.

### 4. События реагирования

- **Эвенты-следствия:** после смены власти запускаются эвенты «Rebuild», «Purge», «Reprisal». Выбор игрока влияет на направление дальнейших арок.
- **Story hooks:** система выбирает NPC, квесты или экономические зоны для реагирования (обновляет списки в `quest-system.md`).
- **Kenchi link:** аналог «создания собственных историй» через реакцию мира на действия игрока.

---

## Гибридная прокачка «Действие + Ранги»

### 1. Двойной трек опыта

- **Использование:** за каждое действие начисляется `Action XP` (мультипликаторы зависят от нагрузки, сложности цели, риска).
- **Ранги:** текущая система рангов R1–R5 из `progression-skills.md` остаётся главной, но пороги повышаются `Action XP`.
- **Формула:**  
  `SkillXP = BaseQuestXP + (ActionXP × ActivityMultiplier × SoftCapModifier)`

### 2. Поведенческие модификаторы

- **Перегрузка = Сила:** перенос тяжёлых контейнеров, эвакуация товарищей, доставка боеприпасов увеличивают STR Action XP.
- **Боевая стойкость = Крепость:** получение урона в бою без нокдауна даёт `Resilience ticks`.
- **Скрытность:** передвижение в зоне видимости патрулей, взлом турелей, диверсии.
- **Инженерия и медицина:** использование ремонтных станций, установка имплантов, спасение NPC.

### 3. Тренажёры и симуляторы

- **Строимые объекты:** Dojo, HackLab, Field Hospital. Дают контролируемый прирост Action XP, но с задержкой и расходом ресурсов.
- **Сопротивление:** эффективность тренировки убывает без риска (аналог затухающей отдачи при фарме одной ситуации в Kenshi).

### 4. Мягкие капы и усталость

- **Soft cap:** при превышении дневного лимита Action XP эффективность падает до 25% (вдохновение — затухающая отдача Kenshi).
- **Усталость:** длительные тренировки снижают STA/ENG, увеличивают шанс травмы (перенос идеи лимбов и медленного восстановления).

---

## Синхронизация с существующими системами

- `player-impact-mechanics.md`: использовать новые типы влияния «Faction Overthrow», «Settlement Upgrade», «Logistics Disruption».
- `player-impact-systems.md`: добавить обработчики событий Action XP → World Events (боевой отчёт обновляет контроль территории).
- `progression-skills.md`: расширить таблицы модификаторов новыми коэффициентами `ActionWeight`, `FatiguePenalty`, `TrainerBoost`.
- `global-state-core.md`: добавить агрегаты `faction_control`, `logistics_routes`, `player_story_arcs`.
- `economy-world-impact.md`: связать производство баз с динамикой цен.

---

## Игровые сценарии

1. **«Освободитель района»**  
   - Игроки уничтожают лидера корп-гвардии → город переходит к повстанцам.  
   - Параллельно получают Action XP за штурм (стрельба, медицина, инженерия).  
   - В ответ появляются репрессии, открываются новые квесты и торговые санкции.

2. **«Караванный магнат»**  
   - Игрок строит логистический узел, защищает караваны, экспортирует ресурсы.  
   - Экономика региона меняется, фракции предлагают договоры.  
   - Прокачка силы и инженерии через тяжёлые грузы и ремонт турелей.

3. **«Тень мегаполиса»**  
   - Стелс-операции в городе: слежка, взлом, саботаж энергосети.  
   - Фракция теряет контроль над ключевыми объектами, запускается эвент «Blackout».  
   - Игроки получают Action XP в стелсе, хакерстве, социальной инженерии.

---

## Данные и API

- **События world-service:**  
  - `FactionLeaderNeutralized`, `FactionControlShifted`, `SettlementUpgraded`.  
  - `LogisticsRouteCreated`, `LogisticsRouteDisrupted`, `SquadSpawned`, `SquadDefeated`.
- **Action XP события gameplay-service:**  
  - `ActionXpGained` с полями `skill`, `intensity`, `riskLevel`, `fatigue`.
- **REST/WS расширения:**  
  - `GET /api/v1/world/factions/{id}/control`  
  - `GET /api/v1/world/logistics/routes`  
  - `POST /api/v1/progression/action-xp` (bulk ingestion)
- **Фронтенд:** хроника мира, ленты «истории героя», экраны тренажёров и баз.

---

## Метрики и баланс

- Квоты на генерацию Action XP по типам действий (боевые, экономические, социальные).
- Мониторинг смен власти и задержек перехвата территорий.
- Аналитика усталости: сколько времени игроки проводят в тренажёрах против живых действий.
- Отслеживание цепочек «действие → событие → ответ» для процедурных нарративов.

---

## Открытые вопросы

- Требуется определить точные коэффициенты Action XP и пороги рангов для каждого навыка.
- Нужна детализация логистических маршрутов и расписания отрядов: сколько одновременно активных сквадов выдержит сервер.
- Требуется описать UX для хроники мира и отображения динамики фракций во фронтенде.
- Следует решить, какие события могут инициировать игроки (контракты на смену власти) и какие — только мир.

---

## Следующие шаги

1. Согласовать систему Action XP с дизайнерами progression (`progression-skills.md`) и определить таблицы коэффициентов.
2. Подготовить технические требования для world-service (агрегаты faction_control, logistics_routes).
3. Разработать эволюцию событий для `quest-system.md` с учётом новых мировых арок.
4. Согласовать формат новых API с API-SWAGGER и добавить черновик спецификаций.


